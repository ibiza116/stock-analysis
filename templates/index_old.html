<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Analysis</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', Roboto, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0;
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 50%, #1a202c 100%);
            color: #ffffff;
            min-height: 100vh;
        }
        
        /* Header Design */
        .app-header {
            background: linear-gradient(145deg, #2d3748, #1a202c);
            padding: 15px 30px;
            border-bottom: 1px solid #4a5568;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .app-title {
            font-size: 24px;
            font-weight: 700;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .app-title::before {
            content: "üìà";
            font-size: 28px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }
        
        .app-status {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 14px;
            color: #a0aec0;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #48bb78;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* Main Content */
        .main-content {
            padding: 25px 30px;
        }
        .input-section {
            background: linear-gradient(145deg, #2d3748, #1a202c);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 1px solid #4a5568;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        .input-section label {
            color: #e2e8f0;
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }
        .input-section input, .input-section select, .input-section button {
            margin: 8px;
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid #4a5568;
            background: #1a202c;
            color: #e2e8f0;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .input-section input:focus, .input-section select:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.3);
            background: #2d3748;
        }
        .input-section button {
            background: linear-gradient(145deg, #4299e1, #3182ce);
            color: #ffffff;
            font-weight: 600;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-color: #3b82f6;
        }
        .input-section button:hover {
            background: linear-gradient(145deg, #2563eb, #1d4ed8);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.25);
        }
        .chart-container {
            margin: 25px 0;
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #cbd5e1;
            box-shadow: 0 8px 32px rgba(30, 41, 59, 0.08);
        }
        .signal-box {
            padding: 18px;
            margin: 12px 0;
            border-radius: 10px;
            border: 1px solid;
            backdrop-filter: blur(10px);
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(255,255,255,0.8);
        }
        .buy-signal { 
            background: linear-gradient(145deg, rgba(34, 197, 94, 0.1), rgba(16, 185, 129, 0.1)); 
            color: #059669; 
            border-color: #10b981;
        }
        .sell-signal { 
            background: linear-gradient(145deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.1)); 
            color: #dc2626; 
            border-color: #ef4444;
        }
        .watch-signal { 
            background: linear-gradient(145deg, rgba(245, 158, 11, 0.1), rgba(217, 119, 6, 0.1)); 
            color: #d97706; 
            border-color: #f59e0b;
        }
        .loading { display: none; color: #3b82f6; font-weight: 600; }
        .memo-section {
            background: linear-gradient(145deg, #2d3748, #1a202c);
            padding: 25px;
            border-radius: 12px;
            margin-top: 25px;
            border: 1px solid #4a5568;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        .memo-section h3 {
            margin-top: 0;
            color: #e2e8f0;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }
        .memo-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .memo-table th {
            background: linear-gradient(145deg, #4a5568, #2d3748);
            border: 1px solid #4a5568;
            padding: 12px 10px;
            text-align: center;
            font-weight: bold;
            color: #e2e8f0;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }
        .memo-table td {
            border: 1px solid #4a5568;
            padding: 8px 10px;
            background: rgba(26, 32, 44, 0.8);
        }
        .memo-table input {
            width: 100%;
            border: none;
            background: transparent;
            padding: 8px;
            font-size: 14px;
            color: #e2e8f0;
        }
        .memo-table input:focus {
            background: rgba(248, 250, 252, 1);
            border: 1px solid #3b82f6;
            outline: none;
            border-radius: 4px;
        }
        .memo-table tr:nth-child(even) {
            background-color: rgba(241, 245, 249, 0.5);
        }
        .memo-table tr:hover {
            background-color: rgba(59, 130, 246, 0.05);
        }
        .memo-status {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            text-align: right;
        }
        .memo-status.saved {
            color: #4CAF50;
        }
        .memo-table-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .memo-table-container::-webkit-scrollbar {
            width: 8px;
        }
        .memo-table-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        .memo-table-container::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        .memo-table-container::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        /* „Éï„Ç°„É≥„ÉÄ„É°„É≥„Çø„É´ÂàÜÊûêÁî®„Çπ„Çø„Ç§„É´ */
        .analysis-section {
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            border: 1px solid #cbd5e1;
            box-shadow: 0 8px 32px rgba(30, 41, 59, 0.08);
        }
        .analysis-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }
        .analysis-card {
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #cbd5e1;
            box-shadow: 0 4px 16px rgba(30, 41, 59, 0.05);
        }
        .analysis-card h4 {
            margin: 0 0 15px 0;
            color: #475569;
            font-size: 18px;
            font-weight: 700;
        }
        .metric-row {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 5px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .metric-label {
            font-weight: bold;
            color: #64748b;
        }
        .metric-value {
            color: #1e293b;
            font-weight: 600;
        }
        .rating-positive { color: #059669; font-weight: bold; }
        .rating-negative { color: #dc2626; font-weight: bold; }
        .rating-neutral { color: #d97706; font-weight: bold; }
        .investment-advice {
            background: linear-gradient(145deg, #dbeafe, #bfdbfe);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border: 1px solid #93c5fd;
        }
        .advice-recommendation {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .advice-list {
            margin: 8px 0;
        }
        .advice-list ul {
            margin: 5px 0;
            padding-left: 20px;
        }
        .tabs {
            display: flex;
            border-bottom: 2px solid #cbd5e1;
            margin-bottom: 20px;
        }
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border: 1px solid #cbd5e1;
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            border-radius: 10px 10px 0 0;
            margin-right: 8px;
            color: #475569;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .tab:hover {
            background: linear-gradient(145deg, #f8fafc, #e2e8f0);
            transform: translateY(-2px);
            border-color: #3b82f6;
        }
        .tab.active {
            background: linear-gradient(145deg, #3b82f6, #2563eb);
            color: #ffffff;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.25);
            border-color: #3b82f6;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        
        /* „Éê„ÉÉ„ÇØ„ÉÜ„Çπ„ÉàÁî®„Çπ„Çø„Ç§„É´ */
        .backtest-controls {
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 1px solid #cbd5e1;
            box-shadow: 0 8px 32px rgba(30, 41, 59, 0.08);
        }
        
        .control-row {
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .control-row label {
            min-width: 100px;
            font-weight: 600;
            color: #475569;
        }
        
        .control-row input, .control-row select {
            padding: 8px 12px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            background: #ffffff;
        }
        
        .backtest-button {
            background: linear-gradient(145deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
        }
        
        .backtest-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
        }
        
        .backtest-results {
            margin-top: 25px;
        }
        
        .performance-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
            padding: 20px 0;
        }
        
        .performance-card {
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #cbd5e1;
            text-align: center;
            box-shadow: 0 4px 16px rgba(30, 41, 59, 0.08);
        }
        
        .performance-card h4 {
            margin: 0 0 10px 0;
            color: #475569;
            font-size: 14px;
        }
        
        .performance-card .value {
            font-size: 24px;
            font-weight: 700;
            margin: 5px 0;
        }
        
        .performance-card .value.positive {
            color: #10b981;
        }
        
        .performance-card .value.negative {
            color: #ef4444;
        }
        
        .performance-card .value.neutral {
            color: #3b82f6;
        }
        
        .results-charts {
            display: flex;
            flex-direction: column;
            gap: 25px;
            margin: 35px 0;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
        }
        
        .chart-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 50px;
            padding-bottom: 30px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .results-charts .chart-container {
            height: 400px;
            min-height: 350px;
            margin: 0;
            position: relative;
            z-index: 1;
        }
        
        .results-details {
            margin-top: 50px;
            padding-top: 30px;
            border-top: 2px solid #e2e8f0;
            clear: both;
            position: relative;
            z-index: 2;
            background: #ffffff;
        }
        
        .tabs-sub {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .tab-sub {
            background: linear-gradient(145deg, #f8fafc, #e2e8f0);
            border: none;
            padding: 12px 20px;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-weight: 600;
            color: #64748b;
            transition: all 0.3s ease;
        }
        
        .tab-sub.active {
            background: linear-gradient(145deg, #3b82f6, #2563eb);
            color: #ffffff;
            transform: translateY(-2px);
        }
        
        .sub-tab-content {
            display: none;
        }
        
        .sub-tab-content.active {
            display: block;
        }
        
        .trades-table {
            overflow-x: auto;
            margin-top: 20px;
            position: relative;
            z-index: 3;
            background: #ffffff;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 16px rgba(30, 41, 59, 0.08);
        }
        
        .trades-table table {
            width: 100%;
            border-collapse: collapse;
            background: #ffffff;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 16px rgba(30, 41, 59, 0.08);
        }
        
        .trades-table th, .trades-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .trades-table th {
            background: linear-gradient(145deg, #f1f5f9, #e2e8f0);
            font-weight: 600;
            color: #475569;
        }
        
        .trades-table .profit {
            color: #10b981;
            font-weight: 600;
        }
        
        .trades-table .loss {
            color: #ef4444;
            font-weight: 600;
        }
        
        /* Portfolio Management Styles */
        .portfolio-section {
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            border: 1px solid #cbd5e1;
            box-shadow: 0 8px 32px rgba(30, 41, 59, 0.08);
        }
        .portfolio-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }
        .portfolio-card {
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #cbd5e1;
            box-shadow: 0 4px 16px rgba(30, 41, 59, 0.05);
        }
        .portfolio-summary {
            background: linear-gradient(145deg, #f0f9ff, #e0f2fe);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #0284c7;
            margin-bottom: 20px;
        }
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .summary-item {
            text-align: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
        }
        .summary-item .label {
            font-size: 12px;
            color: #64748b;
            margin-bottom: 5px;
        }
        .summary-item .value {
            font-size: 18px;
            font-weight: bold;
            color: #1e293b;
        }
        .summary-item .positive {
            color: #059669;
        }
        .summary-item .negative {
            color: #dc2626;
        }
        .portfolio-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .portfolio-table th {
            background: linear-gradient(145deg, #f1f5f9, #e2e8f0);
            border: 1px solid #cbd5e1;
            padding: 12px 8px;
            text-align: center;
            font-weight: bold;
            color: #475569;
            font-size: 12px;
        }
        .portfolio-table td {
            border: 1px solid #cbd5e1;
            padding: 8px;
            text-align: center;
            background: rgba(248, 250, 252, 0.8);
            font-size: 12px;
        }
        .portfolio-table .profit {
            color: #059669;
            font-weight: bold;
        }
        .portfolio-table .loss {
            color: #dc2626;
            font-weight: bold;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #475569;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            background: #ffffff;
            color: #1e293b;
            font-size: 14px;
            box-sizing: border-box;
        }
        .form-group textarea {
            height: 80px;
            resize: vertical;
        }
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .btn-primary {
            background: linear-gradient(145deg, #3b82f6, #2563eb);
            color: white;
        }
        .btn-primary:hover {
            background: linear-gradient(145deg, #2563eb, #1d4ed8);
            transform: translateY(-1px);
        }
        .btn-danger {
            background: linear-gradient(145deg, #ef4444, #dc2626);
            color: white;
        }
        .btn-danger:hover {
            background: linear-gradient(145deg, #dc2626, #b91c1c);
            transform: translateY(-1px);
        }
        .btn-secondary {
            background: linear-gradient(145deg, #6b7280, #4b5563);
            color: white;
        }
        .btn-secondary:hover {
            background: linear-gradient(145deg, #4b5563, #374151);
            transform: translateY(-1px);
        }
        .portfolio-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }
        .portfolio-tab {
            padding: 12px 20px;
            cursor: pointer;
            border: none;
            background: none;
            color: #64748b;
            font-weight: 600;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }
        .portfolio-tab:hover {
            color: #3b82f6;
            background: rgba(59, 130, 246, 0.05);
        }
        .portfolio-tab.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }
        .portfolio-tab-content {
            display: none;
        }
        .portfolio-tab-content.active {
            display: block;
        }
        .note-item {
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #cbd5e1;
            margin-bottom: 10px;
        }
        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .note-title {
            font-weight: bold;
            color: #1e293b;
        }
        .note-meta {
            font-size: 12px;
            color: #64748b;
        }
        .note-content {
            color: #475569;
            line-height: 1.5;
        }
        .history-item {
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #cbd5e1;
            margin-bottom: 10px;
        }
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .history-type {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }
        .history-type.technical {
            background: #dbeafe;
            color: #1d4ed8;
        }
        .history-type.fundamental {
            background: #d1fae5;
            color: #047857;
        }
        .history-type.backtest {
            background: #fef3c7;
            color: #92400e;
        }
        
        .detailed-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .metric-group {
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #cbd5e1;
            box-shadow: 0 4px 16px rgba(30, 41, 59, 0.08);
        }
        
        .metric-group h4 {
            margin: 0 0 15px 0;
            color: #1e293b;
            font-size: 16px;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
        }
        
        .metric-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 5px 0;
        }
        
        .metric-label {
            color: #64748b;
        }
        
        .metric-value {
            font-weight: 600;
            color: #1e293b;
        }
        
        .loading-spinner {
            border: 4px solid #e2e8f0;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Êñ∞„Åó„ÅÑ„Éê„ÉÉ„ÇØ„ÉÜ„Çπ„ÉàUIÁî®„Çπ„Çø„Ç§„É´ */
        .backtest-explanation {
            background: linear-gradient(145deg, #f0f9ff, #e0f2fe);
            border: 2px solid #0ea5e9;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(14, 165, 233, 0.1);
        }
        
        .explanation-content {
            margin-top: 15px;
        }
        
        .explanation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .explanation-card {
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #cbd5e1;
            box-shadow: 0 4px 16px rgba(30, 41, 59, 0.08);
        }
        
        .explanation-card h4 {
            margin: 0 0 12px 0;
            color: #1e293b;
            font-size: 16px;
        }
        
        .explanation-card ul, .explanation-card ol {
            margin: 0;
            padding-left: 20px;
        }
        
        .explanation-card li {
            margin: 8px 0;
            color: #475569;
            line-height: 1.5;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin: 20px 0;
        }
        
        .setting-group {
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #cbd5e1;
            box-shadow: 0 4px 16px rgba(30, 41, 59, 0.08);
        }
        
        .setting-group h4 {
            margin: 0 0 8px 0;
            color: #1e293b;
            font-size: 16px;
        }
        
        .setting-description {
            color: #64748b;
            font-size: 14px;
            margin: 0 0 15px 0;
            line-height: 1.4;
        }
        
        .preset-buttons {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .preset-btn {
            background: linear-gradient(145deg, #e2e8f0, #cbd5e1);
            border: 1px solid #94a3b8;
            color: #475569;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .preset-btn:hover {
            background: linear-gradient(145deg, #cbd5e1, #94a3b8);
            transform: translateY(-1px);
        }
        
        .strategy-description {
            background: linear-gradient(145deg, #fef3c7, #fde68a);
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 12px;
            margin-top: 10px;
            font-size: 14px;
            color: #92400e;
            line-height: 1.4;
        }
        
        .setting-note {
            display: block;
            color: #64748b;
            font-style: italic;
            margin-top: 8px;
            line-height: 1.3;
        }
        
        .execute-section {
            text-align: center;
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(145deg, #f8fafc, #e2e8f0);
            border-radius: 12px;
            border: 1px solid #cbd5e1;
        }
        
        .execute-note {
            margin: 10px 0 0 0;
            color: #64748b;
            font-size: 14px;
            font-style: italic;
        }
        
        .results-interpretation {
            margin-bottom: 20px;
        }
        
        .interpretation-toggle {
            margin-bottom: 15px;
        }
        
        .guide-toggle-btn {
            background: linear-gradient(145deg, #fbbf24, #f59e0b);
            color: #92400e;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .guide-toggle-btn:hover {
            background: linear-gradient(145deg, #f59e0b, #d97706);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.3);
        }
        
        .results-guide {
            background: linear-gradient(145deg, #fefce8, #fef3c7);
            border: 2px solid #eab308;
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
        }
        
        .guide-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }
        
        .guide-item {
            background: linear-gradient(145deg, #ffffff, #fefcf9);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #fbbf24;
        }
        
        .guide-item h5 {
            margin: 0 0 8px 0;
            color: #92400e;
            font-size: 14px;
        }
        
        .guide-item p {
            margin: 0;
            color: #78716c;
            font-size: 13px;
            line-height: 1.4;
        }
        
        .overall-rating {
            margin: 25px 0;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            font-weight: 600;
            font-size: 18px;
            clear: both;
        }
        
        .overall-rating.excellent {
            background: linear-gradient(145deg, #dcfce7, #bbf7d0);
            border: 2px solid #16a34a;
            color: #166534;
        }
        
        .overall-rating.good {
            background: linear-gradient(145deg, #fef3c7, #fde68a);
            border: 2px solid #eab308;
            color: #92400e;
        }
        
        .overall-rating.poor {
            background: linear-gradient(145deg, #fecaca, #fca5a5);
            border: 2px solid #dc2626;
            color: #991b1b;
        }
        
        @media (max-width: 768px) {
            .chart-section {
                grid-template-columns: 1fr;
                margin-bottom: 30px;
            }
            
            .results-charts .chart-container {
                height: 300px;
                min-height: 250px;
            }
            
            .results-details {
                margin-top: 30px;
                padding-top: 20px;
            }
            
            .performance-cards {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .control-row {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .control-row label {
                min-width: auto;
            }
            
            .explanation-grid {
                grid-template-columns: 1fr;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .preset-buttons {
                justify-content: center;
            }
            
            .guide-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Application Header -->
    <div class="app-header">
        <div class="app-title">Stock Analysis</div>
        <div class="app-status">
            <span class="status-indicator"></span>
            <span>Live Market Data</span>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
    
    <div class="input-section">
        <label for="ticker">ÈäòÊüÑ„Ç≥„Éº„ÉâÔºà4Ê°ÅÔºâ:</label>
        <input type="text" id="ticker" placeholder="‰æã: 7203Ôºà„Éà„É®„ÇøÔºâ" maxlength="4" value="">
        
        <label for="period">ÊúüÈñì:</label>
        <select id="period">
            <option value="3mo">3„É∂Êúà</option>
            <option value="6mo" selected>6„É∂Êúà</option>
            <option value="1y">1Âπ¥</option>
        </select>
        
        <button onclick="analyzeStock()">ÂàÜÊûêÈñãÂßã</button>
        <span class="loading" id="loading">ÂàÜÊûê‰∏≠...</span>
    </div>
    
    <div class="memo-section">
        <h3>üìù ÊäïË≥á„É°„É¢‰∏ÄË¶ß</h3>
        <div class="memo-table-container">
            <table class="memo-table">
            <thead>
                <tr>
                    <th style="width: 15%;">ÈäòÊüÑÁï™Âè∑</th>
                    <th style="width: 25%;">ÈäòÊüÑÂêç</th>
                    <th style="width: 60%;">„É°„É¢</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><input type="text" placeholder="" maxlength="4"></td>
                    <td><input type="text" placeholder=""></td>
                    <td><input type="text" placeholder=""></td>
                </tr>
                <tr>
                    <td><input type="text" placeholder="" maxlength="4"></td>
                    <td><input type="text" placeholder=""></td>
                    <td><input type="text" placeholder=""></td>
                </tr>
                <tr>
                    <td><input type="text" placeholder="" maxlength="4"></td>
                    <td><input type="text" placeholder=""></td>
                    <td><input type="text" placeholder=""></td>
                </tr>
                <tr>
                    <td><input type="text" placeholder="" maxlength="4"></td>
                    <td><input type="text" placeholder=""></td>
                    <td><input type="text" placeholder=""></td>
                </tr>
                <tr>
                    <td><input type="text" placeholder="" maxlength="4"></td>
                    <td><input type="text" placeholder=""></td>
                    <td><input type="text" placeholder=""></td>
                </tr>
                <tr>
                    <td><input type="text" placeholder="" maxlength="4"></td>
                    <td><input type="text" placeholder=""></td>
                    <td><input type="text" placeholder=""></td>
                </tr>
                <tr>
                    <td><input type="text" placeholder="" maxlength="4"></td>
                    <td><input type="text" placeholder=""></td>
                    <td><input type="text" placeholder=""></td>
                </tr>
                <tr>
                    <td><input type="text" placeholder="" maxlength="4"></td>
                    <td><input type="text" placeholder=""></td>
                    <td><input type="text" placeholder=""></td>
                </tr>
                <tr>
                    <td><input type="text" placeholder="" maxlength="4"></td>
                    <td><input type="text" placeholder=""></td>
                    <td><input type="text" placeholder=""></td>
                </tr>
                <tr>
                    <td><input type="text" placeholder="" maxlength="4"></td>
                    <td><input type="text" placeholder=""></td>
                    <td><input type="text" placeholder=""></td>
                </tr>
                <tr>
                    <td><input type="text" placeholder="" maxlength="4"></td>
                    <td><input type="text" placeholder=""></td>
                    <td><input type="text" placeholder=""></td>
                </tr>
                <tr>
                    <td><input type="text" placeholder="" maxlength="4"></td>
                    <td><input type="text" placeholder=""></td>
                    <td><input type="text" placeholder=""></td>
                </tr>
                <tr>
                    <td><input type="text" placeholder="" maxlength="4"></td>
                    <td><input type="text" placeholder=""></td>
                    <td><input type="text" placeholder=""></td>
                </tr>
                <tr>
                    <td><input type="text" placeholder="" maxlength="4"></td>
                    <td><input type="text" placeholder=""></td>
                    <td><input type="text" placeholder=""></td>
                </tr>
                <tr>
                    <td><input type="text" placeholder="" maxlength="4"></td>
                    <td><input type="text" placeholder=""></td>
                    <td><input type="text" placeholder=""></td>
                </tr>
                <tr>
                    <td><input type="text" placeholder="" maxlength="4"></td>
                    <td><input type="text" placeholder=""></td>
                    <td><input type="text" placeholder=""></td>
                </tr>
                <tr>
                    <td><input type="text" placeholder="" maxlength="4"></td>
                    <td><input type="text" placeholder=""></td>
                    <td><input type="text" placeholder=""></td>
                </tr>
                <tr>
                    <td><input type="text" placeholder="" maxlength="4"></td>
                    <td><input type="text" placeholder=""></td>
                    <td><input type="text" placeholder=""></td>
                </tr>
                <tr>
                    <td><input type="text" placeholder="" maxlength="4"></td>
                    <td><input type="text" placeholder=""></td>
                    <td><input type="text" placeholder=""></td>
                </tr>
            </tbody>
        </table>
        </div>
        <div class="memo-status" id="memo-status">„É°„É¢„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠...</div>
    </div>
    
    <div id="results" style="display: none;">
        <div class="tabs">
            <button class="tab active" onclick="showTab('technical-tab')">Âü∫Êú¨„ÉÜ„ÇØ„Éã„Ç´„É´</button>
            <button class="tab" onclick="showTab('advanced-tab')">È´òÂ∫¶„ÉÜ„ÇØ„Éã„Ç´„É´</button>
            <button class="tab" onclick="showTab('fundamental-tab')">„Éï„Ç°„É≥„ÉÄ„É°„É≥„Çø„É´</button>
            <button class="tab" onclick="showTab('backtest-tab')">„Éê„ÉÉ„ÇØ„ÉÜ„Çπ„Éà</button>
            <button class="tab" onclick="showTab('portfolio-tab')">„Éù„Éº„Éà„Éï„Ç©„É™„Ç™</button>
        </div>
        
        <div id="technical-tab" class="tab-content active">
            <div id="chart" class="chart-container"></div>
            <div id="signals"></div>
            <div id="golden-crosses"></div>
        </div>
        
        <div id="advanced-tab" class="tab-content">
            <!-- ÊåáÊ®ôËß£Ë™¨„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div class="analysis-section">
                <h3 style="color: #475569; margin-bottom: 20px;">üìö È´òÂ∫¶„ÉÜ„ÇØ„Éã„Ç´„É´ÊåáÊ®ô„ÅÆË¶ãÊñπ„Éª‰Ωø„ÅÑÊñπ</h3>
                <div class="analysis-grid">
                    <div class="analysis-card">
                        <h4>üéØ „Éú„É™„É≥„Ç∏„É£„Éº„Éê„É≥„Éâ</h4>
                        <p><strong>Ê¶ÇË¶Å:</strong> ÁßªÂãïÂπ≥ÂùáÁ∑ö„Çí‰∏≠ÂøÉ„Å®„Åó„Åü‰æ°Ê†º„ÅÆÂ§âÂãïÂπÖ„ÇíÁ§∫„Åô„Éê„É≥„Éâ</p>
                        <p><strong>ÊßãÊàê:</strong></p>
                        <ul style="margin: 8px 0; padding-left: 20px; color: #64748b;">
                            <li>‰∏≠Â§ÆÁ∑öÔºö20Êó•ÁßªÂãïÂπ≥ÂùáÁ∑ö</li>
                            <li>‰∏äÈôê„Éª‰∏ãÈôêÔºöÊ®ôÊ∫ñÂÅèÂ∑Æ¬±2œÉ</li>
                        </ul>
                        <p><strong>ÊäïË≥áÂà§Êñ≠:</strong></p>
                        <ul style="margin: 8px 0; padding-left: 20px; color: #64748b;">
                            <li>üî¥ <span style="color: #dc2626;">‰∏äÈôê„Çø„ÉÉ„ÉÅ</span> ‚Üí Â£≤„Çä„Ç∑„Ç∞„Éä„É´ÔºàË≤∑„Çè„Çå„Åô„ÅéÔºâ</li>
                            <li>üü¢ <span style="color: #059669;">‰∏ãÈôê„Çø„ÉÉ„ÉÅ</span> ‚Üí Ë≤∑„ÅÑ„Ç∑„Ç∞„Éä„É´ÔºàÂ£≤„Çâ„Çå„Åô„ÅéÔºâ</li>
                            <li>üü° <span style="color: #d97706;">„Éê„É≥„ÉâÂπÖÁ∏ÆÂ∞è</span> ‚Üí Â§ß„Åç„Å™ÂÄ§Âãï„ÅçÂâç„ÅÆÂâçÂÖÜ</li>
                        </ul>
                    </div>
                    
                    <div class="analysis-card">
                        <h4>üìä MACD</h4>
                        <p><strong>Ê¶ÇË¶Å:</strong> ÁßªÂãïÂπ≥ÂùáÂèéÊùüÊã°Êï£ÊåáÊ®ô„ÄÇ„Éà„É¨„É≥„Éâ„ÅÆÂº∑„Åï„Å®Ëª¢ÊèõÁÇπ„ÇíÂà§ÂÆö</p>
                        <p><strong>ÊßãÊàê:</strong></p>
                        <ul style="margin: 8px 0; padding-left: 20px; color: #64748b;">
                            <li>MACDÁ∑öÔºö12Êó•EMA - 26Êó•EMA</li>
                            <li>„Ç∑„Ç∞„Éä„É´Á∑öÔºöMACDÁ∑ö„ÅÆ9Êó•EMA</li>
                            <li>„Éí„Çπ„Éà„Ç∞„É©„É†ÔºöMACDÁ∑ö - „Ç∑„Ç∞„Éä„É´Á∑ö</li>
                        </ul>
                        <p><strong>ÊäïË≥áÂà§Êñ≠:</strong></p>
                        <ul style="margin: 8px 0; padding-left: 20px; color: #64748b;">
                            <li>üü¢ <span style="color: #059669;">„Ç¥„Éº„É´„Éá„É≥„ÇØ„É≠„Çπ</span> ‚Üí Ë≤∑„ÅÑ„Ç∑„Ç∞„Éä„É´</li>
                            <li>üî¥ <span style="color: #dc2626;">„Éá„ÉÉ„Éâ„ÇØ„É≠„Çπ</span> ‚Üí Â£≤„Çä„Ç∑„Ç∞„Éä„É´</li>
                            <li>üìà <span style="color: #3b82f6;">„Éí„Çπ„Éà„Ç∞„É©„É†Êã°Â§ß</span> ‚Üí „Éà„É¨„É≥„ÉâÂº∑Âåñ</li>
                        </ul>
                    </div>
                    
                    <div class="analysis-card">
                        <h4>‚ö° „Çπ„Éà„Ç≠„É£„Çπ„ÉÜ„Ç£„ÇØ„Çπ</h4>
                        <p><strong>Ê¶ÇË¶Å:</strong> ‰∏ÄÂÆöÊúüÈñì„ÅÆ‰æ°Ê†º„É¨„É≥„Ç∏ÂÜÖ„Åß„ÅÆÁèæÂú®‰æ°Ê†º„ÅÆ‰ΩçÁΩÆ„Çí%„ÅßË°®Á§∫</p>
                        <p><strong>ÊßãÊàê:</strong></p>
                        <ul style="margin: 8px 0; padding-left: 20px; color: #64748b;">
                            <li>%KÁ∑öÔºöÈ´òÂÄ§„ÉªÂÆâÂÄ§„É¨„É≥„Ç∏„Åß„ÅÆÁèæÂú®‰æ°Ê†º‰ΩçÁΩÆ</li>
                            <li>%DÁ∑öÔºö%KÁ∑ö„ÅÆ3Êó•Âπ≥ÊªëÁßªÂãïÂπ≥Âùá</li>
                        </ul>
                        <p><strong>ÊäïË≥áÂà§Êñ≠:</strong></p>
                        <ul style="margin: 8px 0; padding-left: 20px; color: #64748b;">
                            <li>üî¥ <span style="color: #dc2626;">80%‰ª•‰∏ä</span> ‚Üí Ë≤∑„Çè„Çå„Åô„ÅéÔºàÂ£≤„ÇäÊ§úË®éÔºâ</li>
                            <li>üü¢ <span style="color: #059669;">20%‰ª•‰∏ã</span> ‚Üí Â£≤„Çâ„Çå„Åô„ÅéÔºàË≤∑„ÅÑÊ§úË®éÔºâ</li>
                            <li>‚ú® <span style="color: #3b82f6;">%K > %D</span> ‚Üí ‰∏äÊòá„ÅÆÂã¢„ÅÑ</li>
                        </ul>
                    </div>
                    
                    <div class="analysis-card">
                        <h4>üìà Âá∫Êù•È´òÂàÜÊûê</h4>
                        <p><strong>Ê¶ÇË¶Å:</strong> ‰æ°Ê†ºÂ§âÂãï„Å®Âá∫Êù•È´ò„ÅÆÈñ¢‰øÇ„ÇíÂàÜÊûê„ÄÇ„Éà„É¨„É≥„Éâ„ÅÆÁ¢∫ÂÆüÊÄß„ÇíÂà§ÂÆö</p>
                        <p><strong>ÊßãÊàê:</strong></p>
                        <ul style="margin: 8px 0; padding-left: 20px; color: #64748b;">
                            <li>Âá∫Êù•È´òÔºöÂÆüÈöõ„ÅÆÂèñÂºïÈáè</li>
                            <li>Âá∫Êù•È´òÁßªÂãïÂπ≥ÂùáÔºö20Êó•Èñì„ÅÆÂπ≥ÂùáÂá∫Êù•È´ò</li>
                        </ul>
                        <p><strong>ÊäïË≥áÂà§Êñ≠:</strong></p>
                        <ul style="margin: 8px 0; padding-left: 20px; color: #64748b;">
                            <li>üî• <span style="color: #dc2626;">2ÂÄç‰ª•‰∏ä</span> ‚Üí Áï∞Â∏∏Âá∫Êù•È´òÔºàÈáçË¶Å„Å™Âãï„ÅçÔºâ</li>
                            <li>üìä <span style="color: #d97706;">1.5ÂÄç‰ª•‰∏ä</span> ‚Üí È´òÂá∫Êù•È´òÔºàÊ≥®ÁõÆÔºâ</li>
                            <li>üí° <span style="color: #64748b;">‰∏äÊòá+È´òÂá∫Êù•È´ò</span> ‚Üí ‰∏äÊòá„Éà„É¨„É≥„Éâ‰ø°È†ºÊÄßÈ´ò</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- „ÉÅ„É£„Éº„ÉàË°®Á§∫ -->
            <div class="analysis-grid">
                <div id="bollinger-chart" class="chart-container"></div>
                <div id="macd-chart" class="chart-container"></div>
                <div id="stoch-chart" class="chart-container"></div>
                <div id="volume-chart" class="chart-container"></div>
            </div>
            <div id="advanced-signals"></div>
        </div>
        
        <div id="fundamental-tab" class="tab-content">
            <div id="fundamental-analysis" class="analysis-section"></div>
        </div>
        
        <div id="backtest-tab" class="tab-content">
            <!-- „Éê„ÉÉ„ÇØ„ÉÜ„Çπ„ÉàË™¨Êòé„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div class="backtest-explanation">
                <h3>üîÑ „Éê„ÉÉ„ÇØ„ÉÜ„Çπ„Éà„Å®„ÅØÔºü</h3>
                <div class="explanation-content">
                    <p><strong>„Éê„ÉÉ„ÇØ„ÉÜ„Çπ„Éà</strong>„ÅØ„ÄÅÈÅéÂéª„ÅÆÊ†™‰æ°„Éá„Éº„Çø„Çí‰Ωø„Å£„Å¶ÊäïË≥áÊà¶Áï•„ÅÆÊúâÂäπÊÄß„ÇíÊ§úË®º„Åô„Çã„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥Ê©üËÉΩ„Åß„Åô„ÄÇ</p>
                    
                    <div class="explanation-grid">
                        <div class="explanation-card">
                            <h4>üìä ‰Ωï„Åå„Åß„Åç„ÇãÔºü</h4>
                            <ul>
                                <li>ÈÅéÂéª„ÅÆÁõ∏Â†¥„ÅßÊà¶Áï•„ÅåÂà©Áõä„ÇíÂá∫„Åõ„Åü„ÅãÁ¢∫Ë™ç</li>
                                <li>„É™„Çπ„ÇØ„Å®„É™„Çø„Éº„É≥„ÅÆÈñ¢‰øÇ„ÇíÊï∞ÂÄ§„ÅßÊääÊè°</li>
                                <li>Ë§áÊï∞„ÅÆÊäïË≥áÊà¶Áï•„ÇíÊØîËºÉÊ§úË®é</li>
                                <li>ÂÆüÈöõ„ÅÆÊäïË≥áÂâç„Å´„É™„Çπ„ÇØ„ÇíË©ï‰æ°</li>
                            </ul>
                        </div>
                        
                        <div class="explanation-card">
                            <h4>‚ö†Ô∏è Ê≥®ÊÑèÁÇπ</h4>
                            <ul>
                                <li>ÈÅéÂéª„ÅÆÁµêÊûú„ÅØÂ∞ÜÊù•„Çí‰øùË®º„Åó„Åæ„Åõ„Çì</li>
                                <li>ÊâãÊï∞Êñô„ÉªÁ®éÈáë„ÅØËÄÉÊÖÆ„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</li>
                                <li>ÊµÅÂãïÊÄß„É™„Çπ„ÇØ„ÅØÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</li>
                                <li>ÂèÇËÄÉÊÉÖÂ†±„Å®„Åó„Å¶Ê¥ªÁî®„Åó„Å¶„Åè„Å†„Åï„ÅÑ</li>
                            </ul>
                        </div>
                        
                        <div class="explanation-card">
                            <h4>üìà ‰Ωø„ÅÑÊñπ„ÅÆÊµÅ„Çå</h4>
                            <ol>
                                <li>Ê§úË®º„Åó„Åü„ÅÑÊúüÈñì„ÇíË®≠ÂÆö</li>
                                <li>ÊäïË≥áÊà¶Áï•„ÇíÈÅ∏Êäû</li>
                                <li>ÂàùÊúüË≥áÈáë„ÇíÂÖ•Âäõ</li>
                                <li>ÂÆüË°å„Éú„Çø„É≥„Åß„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥ÈñãÂßã</li>
                                <li>ÁµêÊûú„ÇíÂàÜÊûê„Åó„Å¶Êà¶Áï•„ÇíË©ï‰æ°</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- „Éê„ÉÉ„ÇØ„ÉÜ„Çπ„ÉàË®≠ÂÆö„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div class="backtest-controls">
                <h3>‚öôÔ∏è „Éê„ÉÉ„ÇØ„ÉÜ„Çπ„ÉàË®≠ÂÆö</h3>
                
                <div class="settings-grid">
                    <!-- ÊúüÈñìË®≠ÂÆö -->
                    <div class="setting-group">
                        <h4>üìÖ Ê§úË®ºÊúüÈñì</h4>
                        <p class="setting-description">ÈÅéÂéª„ÅÆ„Å©„ÅÆÊúüÈñì„ÅßÊà¶Áï•„Çí„ÉÜ„Çπ„Éà„Åô„Çã„Åã„ÇíË®≠ÂÆö„Åó„Åæ„Åô</p>
                        <div class="control-row">
                            <label>ÈñãÂßãÊó•:</label>
                            <input type="date" id="backtest-start-date" value="">
                        </div>
                        <div class="control-row">
                            <label>ÁµÇ‰∫ÜÊó•:</label>
                            <input type="date" id="backtest-end-date" value="">
                        </div>
                        <div class="preset-buttons">
                            <button type="button" onclick="setPresetPeriod(90)" class="preset-btn">ÈÅéÂéª3„É∂Êúà</button>
                            <button type="button" onclick="setPresetPeriod(180)" class="preset-btn">ÈÅéÂéª6„É∂Êúà</button>
                            <button type="button" onclick="setPresetPeriod(365)" class="preset-btn">ÈÅéÂéª1Âπ¥</button>
                        </div>
                    </div>
                    
                    <!-- Êà¶Áï•Ë®≠ÂÆö -->
                    <div class="setting-group">
                        <h4>üéØ ÊäïË≥áÊà¶Áï•</h4>
                        <p class="setting-description">„Å©„ÅÆÂ£≤Ë≤∑„É´„Éº„É´„Åß„ÉÜ„Çπ„Éà„Åô„Çã„Åã„ÇíÈÅ∏Êäû„Åó„Åæ„Åô</p>
                        <div class="control-row">
                            <select id="strategy-select" onchange="showStrategyDescription()">
                                <option value="combo">Ë§áÂêàÊà¶Áï•ÔºàÊé®Â•®Ôºâ</option>
                                <option value="rsi">RSIÊà¶Áï•</option>
                                <option value="golden_cross">„Ç¥„Éº„É´„Éá„É≥„ÇØ„É≠„ÇπÊà¶Áï•</option>
                                <option value="macd">MACDÊà¶Áï•</option>
                                <option value="bollinger">„Éú„É™„É≥„Ç∏„É£„Éº„Éê„É≥„ÉâÊà¶Áï•</option>
                            </select>
                        </div>
                        <div id="strategy-description" class="strategy-description">
                            <strong>Ë§áÂêàÊà¶Áï•:</strong> RSI„ÄÅÁßªÂãïÂπ≥ÂùáÁ∑ö„ÄÅMACD„ÄÅ„Éú„É™„É≥„Ç∏„É£„Éº„Éê„É≥„Éâ„ÇíÁµÑ„ÅøÂêà„Çè„Åõ„ÅüÁ∑èÂêàÁöÑ„Å™Âà§ÂÆö„ÇíË°å„ÅÑ„Åæ„Åô„ÄÇË§áÊï∞„ÅÆÊåáÊ®ô„Çí‰Ωø„ÅÜ„Åì„Å®„Åß„Çà„ÇäÁ≤æÂ∫¶„ÅÆÈ´ò„ÅÑÂ£≤Ë≤∑„Çø„Ç§„Éü„É≥„Ç∞„ÇíÁãô„ÅÑ„Åæ„Åô„ÄÇÔºàÂàùÂøÉËÄÖ„Å´„Åä„Åô„Åô„ÇÅÔºâ
                        </div>
                    </div>
                    
                    <!-- Ë≥áÈáëË®≠ÂÆö -->
                    <div class="setting-group">
                        <h4>üí∞ ÂàùÊúüË≥áÈáë</h4>
                        <p class="setting-description">ÊäïË≥á„Çí„Çπ„Çø„Éº„Éà„Åô„ÇãÊôÇ„ÅÆË≥áÈáëÈ°ç„ÇíË®≠ÂÆö„Åó„Åæ„Åô</p>
                        <div class="control-row">
                            <input type="number" id="initial-capital" value="1000000" step="100000" min="100000">
                            <span>ÂÜÜ</span>
                        </div>
                        <div class="preset-buttons">
                            <button type="button" onclick="setCapital(500000)" class="preset-btn">50‰∏áÂÜÜ</button>
                            <button type="button" onclick="setCapital(1000000)" class="preset-btn">100‰∏áÂÜÜ</button>
                            <button type="button" onclick="setCapital(3000000)" class="preset-btn">300‰∏áÂÜÜ</button>
                        </div>
                        <small class="setting-note">üí° ÂÆüÈöõ„ÅÆÊäïË≥áÈ°ç„Å´Ëøë„ÅÑÈáëÈ°ç„ÇíË®≠ÂÆö„Åô„Çã„Å®„ÄÅ„Çà„ÇäÂÆüË∑µÁöÑ„Å™ÁµêÊûú„ÅåÂæó„Çâ„Çå„Åæ„Åô</small>
                    </div>
                </div>
                
                <div class="execute-section">
                    <button onclick="runBacktest()" class="backtest-button">
                        üöÄ „Éê„ÉÉ„ÇØ„ÉÜ„Çπ„ÉàÂÆüË°å
                    </button>
                    <p class="execute-note">‚Äª ÂÆüË°å„Å´„ÅØÊï∞Áßí„ÄúÊï∞ÂçÅÁßí„Åã„Åã„ÇãÂ†¥Âêà„Åå„ÅÇ„Çä„Åæ„Åô</p>
                </div>
            </div>
            
            <div id="backtest-results" class="backtest-results" style="display: none;">
                <div class="results-summary">
                    <h3>üìä „Éê„ÉÉ„ÇØ„ÉÜ„Çπ„ÉàÁµêÊûú</h3>
                    <div class="results-interpretation">
                        <div class="interpretation-toggle">
                            <button type="button" onclick="toggleResultsGuide()" class="guide-toggle-btn">
                                üí° ÁµêÊûú„ÅÆË¶ãÊñπ„Ç¨„Ç§„Éâ <span id="guide-toggle-icon">‚ñº</span>
                            </button>
                        </div>
                        <div id="results-guide" class="results-guide" style="display: none;">
                            <div class="guide-grid">
                                <div class="guide-item">
                                    <h5>üìà Á∑è„É™„Çø„Éº„É≥</h5>
                                    <p>ÊäïË≥áÊúüÈñìÂÖ®‰Ωì„Åß„ÅÆÂà©ÁõäÁéá„ÄÇ„Éó„É©„Çπ„Å™„ÇâÂà©Áõä„ÄÅ„Éû„Ç§„Éä„Çπ„Å™„ÇâÊêçÂ§±„ÇíË°®„Åó„Åæ„Åô„ÄÇÂπ¥Âà©ÊèõÁÆó„Åó„Å¶‰ªñ„ÅÆÊäïË≥áÂïÜÂìÅ„Å®ÊØîËºÉ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ</p>
                                </div>
                                <div class="guide-item">
                                    <h5>üéØ ÂãùÁéá</h5>
                                    <p>ÂÖ®ÂèñÂºï„ÅÆ„ÅÜ„Å°Âà©Áõä„ÇíÂá∫„Åó„ÅüÂèñÂºï„ÅÆÂâ≤Âêà„ÄÇÈ´ò„ÅÑ„Åª„Å©ÂÆâÂÆö„Åó„Å¶„ÅÑ„Åæ„Åô„Åå„ÄÅ50%‰ª•‰∏ä„ÅÇ„Çå„Å∞ËâØÂ•Ω„Åß„Åô„ÄÇ</p>
                                </div>
                                <div class="guide-item">
                                    <h5>üìâ ÊúÄÂ§ß„Éâ„É≠„Éº„ÉÄ„Ç¶„É≥</h5>
                                    <p>ÊúÄÂ§ß„ÅÆÊêçÂ§±ÂπÖ„ÄÇÊäïË≥á„ÅßË¶öÊÇü„Åô„Åπ„ÅçÊúÄÂ§ß„ÅÆ‰∏ãËêΩ„ÇíÁ§∫„Åó„Åæ„Åô„ÄÇ10%‰ª•‰∏ã„Å™„ÇâËâØÂ•Ω„ÄÅ20%Ë∂Ö„ÅØË¶ÅÊ≥®ÊÑè„Åß„Åô„ÄÇ</p>
                                </div>
                                <div class="guide-item">
                                    <h5>‚öñÔ∏è „Ç∑„É£„Éº„Éó„É¨„Ç∑„Ç™</h5>
                                    <p>„É™„Çπ„ÇØ„Å´ÂØæ„Åô„Çã„É™„Çø„Éº„É≥„ÅÆÂäπÁéáÊÄß„ÄÇ1.0‰ª•‰∏ä„ÅßËâØÂ•Ω„ÄÅ2.0‰ª•‰∏ä„ÅßÂÑ™ÁßÄ„Å™Êà¶Áï•„Å®Ë®Ä„Åà„Åæ„Åô„ÄÇ</p>
                                </div>
                                <div class="guide-item">
                                    <h5>üè™ „Éê„Ç§&„Éõ„Éº„É´„ÉâÊØîËºÉ</h5>
                                    <p>ÂçòÁ¥î„Å´Ë≤∑„Å£„Å¶ÊåÅ„Å°Á∂ö„Åë„ÅüÂ†¥Âêà„Å®„ÅÆÊØîËºÉ„ÄÇ„Éó„É©„Çπ„Å™„ÇâÊà¶Áï•„Å´‰æ°ÂÄ§„Åå„ÅÇ„Çã„Åì„Å®„ÇíÁ§∫„Åó„Åæ„Åô„ÄÇ</p>
                                </div>
                                <div class="guide-item">
                                    <h5>üìã Á∑èÂêàÂà§ÂÆö</h5>
                                    <p><strong>ÂÑ™ÁßÄ:</strong> ÂÖ®ÊåáÊ®ô„ÅåËâØÂ•Ω„ÄÄ<strong>ËâØÂ•Ω:</strong> Â§ö„Åè„ÅÆÊåáÊ®ô„ÅåËâØÂ•Ω„ÄÄ<strong>Ë¶ÅÊîπÂñÑ:</strong> „É™„Çπ„ÇØ„ÅåÈ´ò„ÅÑ„ÅãÂèéÁõäÊÄß„Åå‰Ωé„ÅÑ</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="performance-summary" class="performance-cards"></div>
                    <div id="overall-rating" class="overall-rating"></div>
                </div>
                
                <div class="results-charts">
                    <div class="chart-section">
                        <div id="backtest-chart" class="chart-container"></div>
                        <div id="performance-chart" class="chart-container"></div>
                    </div>
                </div>
                
                <div class="results-details">
                    <div class="tabs-sub">
                        <button class="tab-sub active" onclick="showSubTab('trade-list')">ÂèñÂºïÂ±•Ê≠¥</button>
                        <button class="tab-sub" onclick="showSubTab('performance-metrics')">Ë©≥Á¥∞ÊåáÊ®ô</button>
                        <button class="tab-sub" onclick="showSubTab('strategy-params')">Êà¶Áï•„Éë„É©„É°„Éº„Çø</button>
                    </div>
                    
                    <div id="trade-list" class="sub-tab-content active">
                        <div id="trades-table" class="trades-table"></div>
                    </div>
                    
                    <div id="performance-metrics" class="sub-tab-content">
                        <div id="detailed-metrics" class="detailed-metrics"></div>
                    </div>
                    
                    <div id="strategy-params" class="sub-tab-content">
                        <div id="strategy-parameters" class="strategy-parameters"></div>
                    </div>
                </div>
            </div>
            
            <div id="backtest-loading" class="loading" style="display: none;">
                <div class="loading-spinner"></div>
                <p>„Éê„ÉÉ„ÇØ„ÉÜ„Çπ„Éà„ÇíÂÆüË°å‰∏≠...</p>
            </div>
        </div>
        
        <div id="portfolio-tab" class="tab-content">
            <!-- Portfolio Management Section -->
            <div class="portfolio-section">
                <h3 style="color: #475569; margin-bottom: 20px;">üíº „Éù„Éº„Éà„Éï„Ç©„É™„Ç™ÁÆ°ÁêÜ</h3>
                
                <!-- Portfolio Summary -->
                <div id="portfolio-summary" class="portfolio-summary">
                    <h4 style="margin: 0 0 15px 0; color: #0f172a;">üìà „Éù„Éº„Éà„Éï„Ç©„É™„Ç™„Çµ„Éû„É™„Éº</h4>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <div class="label">‰øùÊúâÈäòÊüÑÊï∞</div>
                            <div class="value" id="total-stocks">0</div>
                        </div>
                        <div class="summary-item">
                            <div class="label">Á∑èÊäïË≥áÈáëÈ°ç</div>
                            <div class="value" id="total-investment">Ôø•0</div>
                        </div>
                        <div class="summary-item">
                            <div class="label">ÁèæÂú®‰æ°ÂÄ§</div>
                            <div class="value" id="current-value">Ôø•0</div>
                        </div>
                        <div class="summary-item">
                            <div class="label">ÊçüÁõä</div>
                            <div class="value" id="total-profit-loss">Ôø•0</div>
                        </div>
                        <div class="summary-item">
                            <div class="label">ÊçüÁõäÁéá</div>
                            <div class="value" id="total-profit-loss-pct">0.00%</div>
                        </div>
                    </div>
                </div>
                
                <!-- Portfolio Tabs -->
                <div class="portfolio-tabs">
                    <button class="portfolio-tab active" onclick="showPortfolioTab('portfolio-holdings')">Portfolio</button>
                    <button class="portfolio-tab" onclick="showPortfolioTab('watchlist')">Watchlist</button>
                    <button class="portfolio-tab" onclick="showPortfolioTab('notes')">„É°„É¢</button>
                    <button class="portfolio-tab" onclick="showPortfolioTab('history')">History</button>
                </div>
                
                <!-- Portfolio Holdings Tab -->
                <div id="portfolio-holdings" class="portfolio-tab-content active">
                    <div class="portfolio-grid">
                        <div class="portfolio-card">
                            <h4>üìä „Éù„Éº„Éà„Éï„Ç©„É™„Ç™‰∏ÄË¶ß</h4>
                            <div id="portfolio-table-container">
                                <table class="portfolio-table">
                                    <thead>
                                        <tr>
                                            <th>ÈäòÊüÑ</th>
                                            <th>‰ºÅÊ•≠Âêç</th>
                                            <th>‰øùÊúâÊï∞</th>
                                            <th>Âπ≥ÂùáÂèñÂæó‰æ°Ê†º</th>
                                            <th>ÁèæÂú®‰æ°Ê†º</th>
                                            <th>ÊçüÁõä</th>
                                            <th>ÊçüÁõäÁéá</th>
                                            <th>„Ç¢„ÇØ„Ç∑„Éß„É≥</th>
                                        </tr>
                                    </thead>
                                    <tbody id="portfolio-tbody">
                                        <tr>
                                            <td colspan="8" style="text-align: center; color: #64748b; padding: 20px;">
                                                „Éù„Éº„Éà„Éï„Ç©„É™„Ç™„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠...
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="portfolio-card">
                            <h4>‚ûï ÈäòÊüÑËøΩÂä†</h4>
                            <form id="add-to-portfolio-form">
                                <div class="form-group">
                                    <label for="add-ticker">ÈäòÊüÑ„Ç≥„Éº„Éâ (4Ê°Å)</label>
                                    <input type="text" id="add-ticker" maxlength="4" placeholder="7203" required>
                                </div>
                                <div class="form-group">
                                    <label for="add-shares">‰øùÊúâÊï∞</label>
                                    <input type="number" id="add-shares" min="1" placeholder="100" required>
                                </div>
                                <div class="form-group">
                                    <label for="add-price">Âπ≥ÂùáÂèñÂæó‰æ°Ê†º</label>
                                    <input type="number" id="add-price" min="0" step="0.01" placeholder="2800" required>
                                </div>
                                <div class="form-group">
                                    <label for="add-notes">„É°„É¢ (‰ªªÊÑè)</label>
                                    <textarea id="add-notes" placeholder="Ë≥ºÂÖ•ÁêÜÁî±„ÇÑ„É°„É¢„ÇíË®òÂÖ•..."></textarea>
                                </div>
                                <div class="btn-group">
                                    <button type="submit" class="btn btn-primary">ËøΩÂä†</button>
                                    <button type="button" class="btn btn-secondary" onclick="clearAddForm()">„ÇØ„É™„Ç¢</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                
                <!-- Watchlist Tab -->
                <div id="watchlist" class="portfolio-tab-content">
                    <div class="portfolio-grid">
                        <div class="portfolio-card">
                            <h4>üëÄ „Ç¶„Ç©„ÉÉ„ÉÅ„É™„Çπ„Éà</h4>
                            <div id="watchlist-table-container">
                                <table class="portfolio-table">
                                    <thead>
                                        <tr>
                                            <th>ÈäòÊüÑ</th>
                                            <th>‰ºÅÊ•≠Âêç</th>
                                            <th>ÁõÆÊ®ô‰æ°Ê†º</th>
                                            <th>„Ç¢„É©„Éº„Éà</th>
                                            <th>ËøΩÂä†Êó•</th>
                                            <th>„Ç¢„ÇØ„Ç∑„Éß„É≥</th>
                                        </tr>
                                    </thead>
                                    <tbody id="watchlist-tbody">
                                        <tr>
                                            <td colspan="6" style="text-align: center; color: #64748b; padding: 20px;">
                                                „Ç¶„Ç©„ÉÉ„ÉÅ„É™„Çπ„Éà„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠...
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="portfolio-card">
                            <h4>‚ûï „Ç¶„Ç©„ÉÉ„ÉÅ„É™„Çπ„ÉàËøΩÂä†</h4>
                            <form id="add-to-watchlist-form">
                                <div class="form-group">
                                    <label for="watch-ticker">ÈäòÊüÑ„Ç≥„Éº„Éâ (4Ê°Å)</label>
                                    <input type="text" id="watch-ticker" maxlength="4" placeholder="7203" required>
                                </div>
                                <div class="form-group">
                                    <label for="watch-target-price">ÁõÆÊ®ô‰æ°Ê†º (‰ªªÊÑè)</label>
                                    <input type="number" id="watch-target-price" min="0" step="0.01" placeholder="3000">
                                </div>
                                <div class="form-group">
                                    <label for="watch-notes">„É°„É¢ (‰ªªÊÑè)</label>
                                    <textarea id="watch-notes" placeholder="Ê≥®ÁõÆÁêÜÁî±„ÇÑ„É°„É¢„ÇíË®òÂÖ•..."></textarea>
                                </div>
                                <div class="btn-group">
                                    <button type="submit" class="btn btn-primary">ËøΩÂä†</button>
                                    <button type="button" class="btn btn-secondary" onclick="clearWatchForm()">„ÇØ„É™„Ç¢</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                
                <!-- Notes Tab -->
                <div id="notes" class="portfolio-tab-content">
                    <div class="portfolio-grid">
                        <div class="portfolio-card">
                            <h4>üìù ÊäïË≥á„É°„É¢‰∏ÄË¶ß</h4>
                            <div id="notes-container">
                                <div style="text-align: center; color: #64748b; padding: 20px;">
                                    „É°„É¢„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠...
                                </div>
                            </div>
                        </div>
                        
                        <div class="portfolio-card">
                            <h4>‚ûï „É°„É¢ËøΩÂä†</h4>
                            <form id="add-note-form">
                                <div class="form-group">
                                    <label for="note-ticker">ÈäòÊüÑ„Ç≥„Éº„Éâ (4Ê°Å)</label>
                                    <input type="text" id="note-ticker" maxlength="4" placeholder="7203" required>
                                </div>
                                <div class="form-group">
                                    <label for="note-title">„Çø„Ç§„Éà„É´</label>
                                    <input type="text" id="note-title" placeholder="„É°„É¢„ÅÆ„Çø„Ç§„Éà„É´" required>
                                </div>
                                <div class="form-group">
                                    <label for="note-type">„Ç´„ÉÜ„Ç¥„É™</label>
                                    <select id="note-type">
                                        <option value="general">‰∏ÄËà¨</option>
                                        <option value="analysis">ÂàÜÊûê</option>
                                        <option value="strategy">Êà¶Áï•</option>
                                        <option value="risk">„É™„Çπ„ÇØ</option>
                                        <option value="news">„Éã„É•„Éº„Çπ</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="note-content">ÂÜÖÂÆπ</label>
                                    <textarea id="note-content" style="height: 120px;" placeholder="„É°„É¢„ÅÆÂÜÖÂÆπ„ÇíË®òÂÖ•..." required></textarea>
                                </div>
                                <div class="btn-group">
                                    <button type="submit" class="btn btn-primary">‰øùÂ≠ò</button>
                                    <button type="button" class="btn btn-secondary" onclick="clearNoteForm()">„ÇØ„É™„Ç¢</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                
                <!-- History Tab -->
                <div id="history" class="portfolio-tab-content">
                    <div class="portfolio-section">
                        <h4>üìà ÂàÜÊûê„Éª„Éê„ÉÉ„ÇØ„ÉÜ„Çπ„ÉàÂ±•Ê≠¥</h4>
                        <div id="history-container">
                            <div style="text-align: center; color: #64748b; padding: 20px;">
                                Â±•Ê≠¥„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠...
                            </div>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
    </div>
    
    <script>
        async function analyzeStock() {
            console.log('ÂàÜÊûêÈñãÂßã');
            
            const ticker = document.getElementById('ticker').value;
            const period = document.getElementById('period').value;
            
            console.log('Ticker:', ticker, 'Period:', period);
            
            if (!ticker || ticker.length !== 4) {
                alert('4Ê°Å„ÅÆÈäòÊüÑ„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            const loadingElement = document.getElementById('loading');
            loadingElement.style.display = 'inline';
            
            try {
                console.log('API„É™„ÇØ„Ç®„Çπ„ÉàÈÄÅ‰ø°‰∏≠...');
                
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        ticker: ticker, 
                        period: period
                    })
                });
                
                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                console.log('Response data:', result);
                
                if (result.success) {
                    displayResults(result.data);
                } else {
                    alert('„Ç®„É©„Éº: ' + result.error);
                    console.error('API Error:', result.error);
                }
            } catch (error) {
                console.error('Fetch Error:', error);
                alert('ÈÄö‰ø°„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + error.message);
            } finally {
                loadingElement.style.display = 'none';
            }
        }
        
        function displayResults(data) {
            console.log('ÁµêÊûúË°®Á§∫ÈñãÂßã', data);
            
            try {
                document.getElementById('results').style.display = 'block';
                
                // „ÉÜ„ÇØ„Éã„Ç´„É´ÂàÜÊûêÁµêÊûú„ÅÆË°®Á§∫
                displayTechnicalAnalysis(data.technical || data);
                
                // È´òÂ∫¶„ÉÜ„ÇØ„Éã„Ç´„É´ÂàÜÊûêÁµêÊûú„ÅÆË°®Á§∫ÔºàPhase 3Ôºâ
                displayAdvancedTechnicalAnalysis(data.technical || data);
                
                // „Éï„Ç°„É≥„ÉÄ„É°„É≥„Çø„É´ÂàÜÊûêÁµêÊûú„ÅÆË°®Á§∫
                if (data.fundamental) {
                    displayFundamentalAnalysis(data.fundamental, data.stock_info);
                }
                
                console.log('ÁµêÊûúË°®Á§∫ÂÆå‰∫Ü');
                
            } catch (error) {
                console.error('Display Error:', error);
                alert('ÁµêÊûúË°®Á§∫‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + error.message);
            }
        }
        
        function displayTechnicalAnalysis(data) {
            // „ÉÅ„É£„Éº„ÉàÊèèÁîª
            if (data.chart_data) {
                const chartData = data.chart_data;
                const traces = [
                    {
                        x: chartData.dates,
                        y: chartData.prices,
                        type: 'scatter',
                        name: 'ÁµÇÂÄ§',
                        line: {color: 'blue', width: 2}
                    }
                ];
                
                // ÁßªÂãïÂπ≥ÂùáÁ∑ö„ÇíËøΩÂä†Ôºà„Éá„Éº„Çø„Åå„ÅÇ„ÇãÂ†¥ÂêàÔºâ
                if (chartData.sma_25 && chartData.sma_25.some(v => v != null)) {
                    traces.push({
                        x: chartData.dates,
                        y: chartData.sma_25,
                        type: 'scatter',
                        name: '25Êó•ÁßªÂãïÂπ≥Âùá',
                        line: {color: 'green', width: 1}
                    });
                }
                
                if (chartData.sma_75 && chartData.sma_75.some(v => v != null)) {
                    traces.push({
                        x: chartData.dates,
                        y: chartData.sma_75,
                        type: 'scatter',
                        name: '75Êó•ÁßªÂãïÂπ≥Âùá',
                        line: {color: 'red', width: 1}
                    });
                }
                
                const layout = {
                    title: {text: 'üìà Ê†™‰æ°„ÉÅ„É£„Éº„ÉàÔºàÂü∫Êú¨Ôºâ', font: {color: '#1e293b', size: 18}},
                    xaxis: {title: 'Êó•‰ªò', color: '#475569'},
                    yaxis: {title: 'Ê†™‰æ°ÔºàÂÜÜÔºâ', color: '#475569'},
                    height: 500,
                    paper_bgcolor: 'rgba(255,255,255,0)',
                    plot_bgcolor: 'rgba(248, 250, 252, 0.8)',
                    font: {color: '#1e293b'},
                    legend: {
                        bgcolor: 'rgba(255, 255, 255, 0.9)',
                        bordercolor: '#cbd5e1',
                        borderwidth: 1
                    }
                };
                
                Plotly.newPlot('chart', traces, layout);
            }
            
            // „Ç∑„Ç∞„Éä„É´Ë°®Á§∫
            const signalsDiv = document.getElementById('signals');
            signalsDiv.innerHTML = '<h3>Â£≤Ë≤∑„Ç∑„Ç∞„Éä„É´</h3>';
            
            if (data.signals && data.signals.length > 0) {
                data.signals.forEach(signal => {
                    const div = document.createElement('div');
                    div.className = `signal-box ${signal.type}-signal`;
                    const typeText = signal.type === 'buy' ? 'üìà Ë≤∑„ÅÑ' : signal.type === 'sell' ? 'üìâ Â£≤„Çä' : 'üëÄ Ê≥®ÁõÆ';
                    const strengthIcon = signal.strength === 'strong' ? 'üî•' : signal.strength === 'medium' ? '‚ö°' : 'üí°';
                    div.innerHTML = `${strengthIcon} ${typeText}„Ç∑„Ç∞„Éä„É´: ${signal.reason}`;
                    signalsDiv.appendChild(div);
                });
            } else {
                signalsDiv.innerHTML += '<p style="color: #64748b;">ÁèæÂú®„ÄÅÊòéÁ¢∫„Å™Â£≤Ë≤∑„Ç∑„Ç∞„Éä„É´„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>';
            }
            
            // RSIË°®Á§∫
            if (data.latest_rsi) {
                const rsiDiv = document.createElement('div');
                rsiDiv.innerHTML = `<p>ÁèæÂú®„ÅÆRSI: ${data.latest_rsi.toFixed(2)}</p>`;
                signalsDiv.appendChild(rsiDiv);
            }
        }
        
        function displayAdvancedTechnicalAnalysis(data) {
            console.log('È´òÂ∫¶„ÉÜ„ÇØ„Éã„Ç´„É´ÂàÜÊûêË°®Á§∫ÈñãÂßã', data);
            
            // „Éú„É™„É≥„Ç∏„É£„Éº„Éê„É≥„Éâ„ÉÅ„É£„Éº„Éà
            if (data.bollinger_data && data.chart_data) {
                const chartData = data.chart_data;
                const bbData = data.bollinger_data;
                
                const bbTraces = [
                    {
                        x: chartData.dates,
                        y: chartData.prices,
                        type: 'scatter',
                        name: 'ÁµÇÂÄ§',
                        line: {color: '#74b9ff', width: 2}
                    },
                    {
                        x: chartData.dates,
                        y: bbData.upper,
                        type: 'scatter',
                        name: '„Éú„É™„É≥„Ç∏„É£„Éº‰∏äÈôê',
                        line: {color: '#fd79a8', width: 1},
                        fill: 'tonexty'
                    },
                    {
                        x: chartData.dates,
                        y: bbData.middle,
                        type: 'scatter',
                        name: '„Éú„É™„É≥„Ç∏„É£„Éº‰∏≠Â§Æ',
                        line: {color: '#fdcb6e', width: 1}
                    },
                    {
                        x: chartData.dates,
                        y: bbData.lower,
                        type: 'scatter',
                        name: '„Éú„É™„É≥„Ç∏„É£„Éº‰∏ãÈôê',
                        line: {color: '#fd79a8', width: 1},
                        fill: 'tonexty'
                    }
                ];
                
                const bbLayout = {
                    title: {text: 'üéØ „Éú„É™„É≥„Ç∏„É£„Éº„Éê„É≥„Éâ', font: {color: '#1e293b'}},
                    xaxis: {title: 'Êó•‰ªò', color: '#475569'},
                    yaxis: {title: 'Ê†™‰æ°ÔºàÂÜÜÔºâ', color: '#475569'},
                    height: 350,
                    paper_bgcolor: 'rgba(255,255,255,0)',
                    plot_bgcolor: 'rgba(248, 250, 252, 0.8)',
                    font: {color: '#1e293b'}
                };
                
                Plotly.newPlot('bollinger-chart', bbTraces, bbLayout);
            }
            
            // MACD„ÉÅ„É£„Éº„Éà
            if (data.macd_data && data.chart_data) {
                const macdData = data.macd_data;
                const chartData = data.chart_data;
                
                const macdTraces = [
                    {
                        x: chartData.dates,
                        y: macdData.macd,
                        type: 'scatter',
                        name: 'MACD',
                        line: {color: '#00b894', width: 2}
                    },
                    {
                        x: chartData.dates,
                        y: macdData.signal,
                        type: 'scatter',
                        name: '„Ç∑„Ç∞„Éä„É´',
                        line: {color: '#e17055', width: 2}
                    },
                    {
                        x: chartData.dates,
                        y: macdData.histogram,
                        type: 'bar',
                        name: '„Éí„Çπ„Éà„Ç∞„É©„É†',
                        marker: {color: '#6c5ce7'}
                    }
                ];
                
                const macdLayout = {
                    title: {text: 'üìä MACD', font: {color: '#1e293b'}},
                    xaxis: {title: 'Êó•‰ªò', color: '#475569'},
                    yaxis: {title: 'MACDÂÄ§', color: '#475569'},
                    height: 350,
                    paper_bgcolor: 'rgba(255,255,255,0)',
                    plot_bgcolor: 'rgba(248, 250, 252, 0.8)',
                    font: {color: '#1e293b'}
                };
                
                Plotly.newPlot('macd-chart', macdTraces, macdLayout);
            }
            
            // „Çπ„Éà„Ç≠„É£„Çπ„ÉÜ„Ç£„ÇØ„Çπ„ÉÅ„É£„Éº„Éà
            if (data.stoch_data && data.chart_data) {
                const stochData = data.stoch_data;
                const chartData = data.chart_data;
                
                const stochTraces = [
                    {
                        x: chartData.dates,
                        y: stochData.k,
                        type: 'scatter',
                        name: '%K',
                        line: {color: '#a29bfe', width: 2}
                    },
                    {
                        x: chartData.dates,
                        y: stochData.d,
                        type: 'scatter',
                        name: '%D',
                        line: {color: '#fd79a8', width: 2}
                    }
                ];
                
                // Ë≤∑„Çè„Çå„Åô„Åé„ÉªÂ£≤„Çâ„Çå„Åô„Åé„É©„Ç§„É≥„ÇíËøΩÂä†
                stochTraces.push(
                    {
                        x: chartData.dates,
                        y: Array(chartData.dates.length).fill(80),
                        type: 'scatter',
                        name: 'Ë≤∑„Çè„Çå„Åô„Åé(80)',
                        line: {color: '#e74c3c', width: 1, dash: 'dash'},
                        showlegend: false
                    },
                    {
                        x: chartData.dates,
                        y: Array(chartData.dates.length).fill(20),
                        type: 'scatter',
                        name: 'Â£≤„Çâ„Çå„Åô„Åé(20)',
                        line: {color: '#2ecc71', width: 1, dash: 'dash'},
                        showlegend: false
                    }
                );
                
                const stochLayout = {
                    title: {text: '‚ö° „Çπ„Éà„Ç≠„É£„Çπ„ÉÜ„Ç£„ÇØ„Çπ', font: {color: '#1e293b'}},
                    xaxis: {title: 'Êó•‰ªò', color: '#475569'},
                    yaxis: {title: '„Çπ„Éà„Ç≠„É£„ÇπÂÄ§(%)', color: '#475569', range: [0, 100]},
                    height: 350,
                    paper_bgcolor: 'rgba(255,255,255,0)',
                    plot_bgcolor: 'rgba(248, 250, 252, 0.8)',
                    font: {color: '#1e293b'}
                };
                
                Plotly.newPlot('stoch-chart', stochTraces, stochLayout);
            }
            
            // Âá∫Êù•È´ò„ÉÅ„É£„Éº„Éà
            if (data.volume_data && data.chart_data) {
                const volumeData = data.volume_data;
                const chartData = data.chart_data;
                
                const volumeTraces = [
                    {
                        x: chartData.dates,
                        y: volumeData.volume,
                        type: 'bar',
                        name: 'Âá∫Êù•È´ò',
                        marker: {color: '#74b9ff'}
                    },
                    {
                        x: chartData.dates,
                        y: volumeData.volume_sma,
                        type: 'scatter',
                        name: 'Âá∫Êù•È´òÁßªÂãïÂπ≥Âùá',
                        line: {color: '#fd79a8', width: 2}
                    }
                ];
                
                const volumeLayout = {
                    title: {text: 'üìà Âá∫Êù•È´òÂàÜÊûê', font: {color: '#1e293b'}},
                    xaxis: {title: 'Êó•‰ªò', color: '#475569'},
                    yaxis: {title: 'Âá∫Êù•È´ò', color: '#475569'},
                    height: 350,
                    paper_bgcolor: 'rgba(255,255,255,0)',
                    plot_bgcolor: 'rgba(248, 250, 252, 0.8)',
                    font: {color: '#1e293b'}
                };
                
                Plotly.newPlot('volume-chart', volumeTraces, volumeLayout);
            }
            
            // È´òÂ∫¶„Ç∑„Ç∞„Éä„É´Ë°®Á§∫
            const advSignalsDiv = document.getElementById('advanced-signals');
            advSignalsDiv.innerHTML = '<h3 style="color: #475569;">üöÄ È´òÂ∫¶„ÉÜ„ÇØ„Éã„Ç´„É´„Ç∑„Ç∞„Éä„É´</h3>';
            
            let allSignals = [];
            
            // ÂêÑÊåáÊ®ô„ÅÆ„Ç∑„Ç∞„Éä„É´„ÇíÁµ±Âêà
            if (data.bollinger_data && data.bollinger_data.signals) {
                allSignals = allSignals.concat(data.bollinger_data.signals);
            }
            if (data.macd_data && data.macd_data.signals) {
                allSignals = allSignals.concat(data.macd_data.signals);
            }
            if (data.volume_data && data.volume_data.signals) {
                allSignals = allSignals.concat(data.volume_data.signals);
            }
            if (data.stoch_data && data.stoch_data.signals) {
                allSignals = allSignals.concat(data.stoch_data.signals);
            }
            
            if (allSignals.length > 0) {
                allSignals.forEach(signal => {
                    const div = document.createElement('div');
                    div.className = `signal-box ${signal.type}-signal`;
                    const typeText = signal.type === 'buy' ? 'üìà Ë≤∑„ÅÑ' : signal.type === 'sell' ? 'üìâ Â£≤„Çä' : 'üëÄ Ê≥®ÁõÆ';
                    const strengthIcon = signal.strength === 'strong' ? 'üî•' : signal.strength === 'medium' ? '‚ö°' : 'üí°';
                    div.innerHTML = `${strengthIcon} ${typeText}„Ç∑„Ç∞„Éä„É´: ${signal.reason}`;
                    advSignalsDiv.appendChild(div);
                });
            } else {
                advSignalsDiv.innerHTML += '<p style="color: #64748b;">ÁèæÂú®„ÄÅÈ´òÂ∫¶„ÉÜ„ÇØ„Éã„Ç´„É´„Ç∑„Ç∞„Éä„É´„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>';
            }
        }
        
        function displayFundamentalAnalysis(fundamental, stockInfo) {
            const fundamentalDiv = document.getElementById('fundamental-analysis');
            
            if (fundamental.error) {
                fundamentalDiv.innerHTML = `<h3>„Éï„Ç°„É≥„ÉÄ„É°„É≥„Çø„É´ÂàÜÊûê</h3><p>„Ç®„É©„Éº: ${fundamental.error}</p>`;
                return;
            }
            
            const stockName = stockInfo ? stockInfo.company_name : '';
            const currentPrice = stockInfo ? stockInfo.current_price : 0;
            
            let html = `
                <h3>üìä „Éï„Ç°„É≥„ÉÄ„É°„É≥„Çø„É´ÂàÜÊûê - ${stockName} (${currentPrice.toFixed(0)}ÂÜÜ)</h3>
                <div class="analysis-grid">
            `;
            
            // „Éê„É™„É•„Ç®„Éº„Ç∑„Éß„É≥ÂàÜÊûê
            if (fundamental.valuation) {
                const val = fundamental.valuation;
                html += `
                    <div class="analysis-card">
                        <h4>üí∞ „Éê„É™„É•„Ç®„Éº„Ç∑„Éß„É≥</h4>
                        <div class="metric-row">
                            <span class="metric-label">PER:</span>
                            <span class="metric-value">${val.per ? val.per.toFixed(2) + 'ÂÄç' : '„Éá„Éº„Çø„Å™„Åó'}</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">PBR:</span>
                            <span class="metric-value">${val.pbr ? val.pbr.toFixed(2) + 'ÂÄç' : '„Éá„Éº„Çø„Å™„Åó'}</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">PERË©ï‰æ°:</span>
                            <span class="metric-value ${getRatingClass(val.per_rating)}">${val.per_rating}</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">PBRË©ï‰æ°:</span>
                            <span class="metric-value ${getRatingClass(val.pbr_rating)}">${val.pbr_rating}</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">Á∑èÂêàË©ï‰æ°:</span>
                            <span class="metric-value ${getRatingClass(val.overall_rating)}">${val.overall_rating}</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">ÊôÇ‰æ°Á∑èÈ°ç:</span>
                            <span class="metric-value">${val.market_cap_billion ? val.market_cap_billion.toFixed(0) + 'ÂÖÜÂÜÜ' : '„Éá„Éº„Çø„Å™„Åó'}</span>
                        </div>
                    </div>
                `;
            }
            
            // ÈÅ©Ê≠£Ê†™‰æ°ÂàÜÊûê
            if (fundamental.fair_value && fundamental.fair_value.fair_values) {
                const fv = fundamental.fair_value;
                html += `
                    <div class="analysis-card">
                        <h4>üéØ ÈÅ©Ê≠£Ê†™‰æ°</h4>
                `;
                
                if (fv.fair_values.per_based) {
                    html += `
                        <div class="metric-row">
                            <span class="metric-label">PER„Éô„Éº„Çπ:</span>
                            <span class="metric-value">${fv.fair_values.per_based.toFixed(0)}ÂÜÜ</span>
                        </div>
                    `;
                }
                
                if (fv.fair_values.pbr_based) {
                    html += `
                        <div class="metric-row">
                            <span class="metric-label">PBR„Éô„Éº„Çπ:</span>
                            <span class="metric-value">${fv.fair_values.pbr_based.toFixed(0)}ÂÜÜ</span>
                        </div>
                    `;
                }
                
                if (fv.fair_values.average) {
                    const upside = fv.price_comparison.average_upside;
                    html += `
                        <div class="metric-row">
                            <span class="metric-label">Âπ≥ÂùáÈÅ©Ê≠£Ê†™‰æ°:</span>
                            <span class="metric-value">${fv.fair_values.average.toFixed(0)}ÂÜÜ</span>
                        </div>
                        ${upside ? `
                        <div class="metric-row">
                            <span class="metric-label">‰∏äÊòá‰ΩôÂú∞:</span>
                            <span class="metric-value ${upside > 0 ? 'rating-positive' : 'rating-negative'}">${upside > 0 ? '+' : ''}${upside.toFixed(1)}%</span>
                        </div>
                        ` : ''}
                    `;
                }
                
                html += `</div>`;
            }
            
            // ÈÖçÂΩìÂàÜÊûê
            if (fundamental.dividend) {
                const div = fundamental.dividend;
                html += `
                    <div class="analysis-card">
                        <h4>üíé ÈÖçÂΩìÂàÜÊûê</h4>
                        <div class="metric-row">
                            <span class="metric-label">ÈÖçÂΩìÂà©Âõû„Çä:</span>
                            <span class="metric-value">${div.dividend_yield ? div.dividend_yield.toFixed(2) + '%' : '„Éá„Éº„Çø„Å™„Åó'}</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">ÈÖçÂΩìË©ï‰æ°:</span>
                            <span class="metric-value ${getRatingClass(div.yield_rating)}">${div.yield_rating}</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">ÈÖçÂΩìÊÄßÂêë:</span>
                            <span class="metric-value">${div.payout_ratio ? div.payout_ratio.toFixed(1) + '%' : '„Éá„Éº„Çø„Å™„Åó'}</span>
                        </div>
                        ${div.dividend_growth ? `
                        <div class="metric-row">
                            <span class="metric-label">ÈÖçÂΩìÊàêÈï∑Áéá:</span>
                            <span class="metric-value ${div.dividend_growth > 0 ? 'rating-positive' : 'rating-negative'}">${div.dividend_growth > 0 ? '+' : ''}${div.dividend_growth}%</span>
                        </div>
                        ` : ''}
                    </div>
                `;
            }
            
            // Ë≤°ÂãôÂÅ•ÂÖ®ÊÄß
            if (fundamental.financial) {
                const fin = fundamental.financial;
                html += `
                    <div class="analysis-card">
                        <h4>üè¶ Ë≤°ÂãôÂÅ•ÂÖ®ÊÄß</h4>
                        <div class="metric-row">
                            <span class="metric-label">ROE:</span>
                            <span class="metric-value">${fin.roe ? fin.roe.toFixed(1) + '%' : '„Éá„Éº„Çø„Å™„Åó'}</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">Ë≤†ÂÇµÊØîÁéá:</span>
                            <span class="metric-value">${fin.debt_to_equity ? fin.debt_to_equity.toFixed(2) : '„Éá„Éº„Çø„Å™„Åó'}</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">Âñ∂Ê•≠Âà©ÁõäÁéá:</span>
                            <span class="metric-value">${fin.operating_margin ? fin.operating_margin.toFixed(1) + '%' : '„Éá„Éº„Çø„Å™„Åó'}</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">Ë≤°Âãô„Çπ„Ç≥„Ç¢:</span>
                            <span class="metric-value">${fin.financial_score}/100</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">Ë≤°ÂãôË©ï‰æ°:</span>
                            <span class="metric-value ${getRatingClass(fin.financial_rating)}">${fin.financial_rating}</span>
                        </div>
                    </div>
                `;
            }
            
            html += '</div>'; // analysis-gridÁµÇ‰∫Ü
            
            // ÊäïË≥áÂà§Êñ≠
            if (fundamental.investment_advice) {
                const advice = fundamental.investment_advice;
                html += `
                    <div class="investment-advice">
                        <div class="advice-recommendation ${getRatingClass(advice.recommendation)}">
                            üéØ ÊäïË≥áÂà§Êñ≠: ${advice.recommendation}
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">Á∑èÂêà„Çπ„Ç≥„Ç¢:</span>
                            <span class="metric-value">${fundamental.total_score}/100</span>
                        </div>
                `;
                
                if (advice.reasoning && advice.reasoning.length > 0) {
                    html += `
                        <div class="advice-list">
                            <strong>üìà „Éù„Ç∏„ÉÜ„Ç£„ÉñË¶ÅÂõ†:</strong>
                            <ul>
                                ${advice.reasoning.map(reason => `<li>${reason}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
                
                if (advice.risks && advice.risks.length > 0) {
                    html += `
                        <div class="advice-list">
                            <strong>‚ö†Ô∏è „É™„Çπ„ÇØË¶ÅÂõ†:</strong>
                            <ul>
                                ${advice.risks.map(risk => `<li>${risk}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
                
                if (advice.opportunities && advice.opportunities.length > 0) {
                    html += `
                        <div class="advice-list">
                            <strong>üöÄ ÊäïË≥áÊ©ü‰ºö:</strong>
                            <ul>
                                ${advice.opportunities.map(opp => `<li>${opp}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
                
                html += '</div>';
            }
            
            html += `<p style="text-align: right; color: #666; font-size: 12px;">ÂàÜÊûêÊó•ÊôÇ: ${fundamental.analysis_date}</p>`;
            
            fundamentalDiv.innerHTML = html;
        }
        
        function getRatingClass(rating) {
            if (!rating) return '';
            
            const positiveRatings = ['Ââ≤ÂÆâ', '„ÇÑ„ÇÑÂâ≤ÂÆâ', 'ËâØÂ•Ω', 'ÂÑ™ÁßÄ', 'Ë≤∑„ÅÑÊé®Â•®', '„ÇÑ„ÇÑË≤∑„ÅÑ', 'È´ò„ÅÑ', 'ÈÅ©Ê≠£'];
            const negativeRatings = ['Ââ≤È´ò', '„ÇÑ„ÇÑÂâ≤È´ò', 'Ê≥®ÊÑè', 'Âç±Èô∫', 'Â£≤„ÇäÊé®Â•®', '„ÇÑ„ÇÑÂ£≤„Çä', '‰Ωé„ÅÑ'];
            
            if (positiveRatings.some(r => rating.includes(r))) {
                return 'rating-positive';
            } else if (negativeRatings.some(r => rating.includes(r))) {
                return 'rating-negative';
            } else {
                return 'rating-neutral';
            }
        }
        
        function showTab(tabId) {
            // „Åô„Åπ„Å¶„ÅÆ„Çø„Éñ„Å®„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÈùûË°®Á§∫
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // ÈÅ∏Êäû„Åï„Çå„Åü„Çø„Éñ„Å®„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíË°®Á§∫
            event.target.classList.add('active');
            document.getElementById(tabId).classList.add('active');
            
            // „Éù„Éº„Éà„Éï„Ç©„É™„Ç™„Çø„Éñ„ÅåË°®Á§∫„Åï„Çå„Åü„Å®„Åç„Å´„Éá„Éº„Çø„Çí„É≠„Éº„Éâ
            if (tabId === 'portfolio-tab' && typeof loadPortfolioData === 'function') {
                loadPortfolioData();
            }
        }
        
        // „É°„É¢„Éá„Éº„Çø„ÅÆ„É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏ÁÆ°ÁêÜ
        const MEMO_STORAGE_KEY = 'stock_analysis_memo_data';
        
        // „É°„É¢„Éá„Éº„Çø„Çí‰øùÂ≠ò
        function saveMemoData() {
            const memoData = [];
            const rows = document.querySelectorAll('.memo-table tbody tr');
            
            rows.forEach(row => {
                const inputs = row.querySelectorAll('input');
                const ticker = inputs[0].value.trim();
                const name = inputs[1].value.trim();
                const memo = inputs[2].value.trim();
                
                if (ticker || name || memo) {
                    memoData.push({
                        ticker: ticker,
                        name: name,
                        memo: memo
                    });
                }
            });
            
            try {
                localStorage.setItem(MEMO_STORAGE_KEY, JSON.stringify(memoData));
                updateMemoStatus('„É°„É¢„Éá„Éº„Çø„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü', true);
                console.log('„É°„É¢„Éá„Éº„Çø‰øùÂ≠òÂÆå‰∫Ü:', memoData);
            } catch (error) {
                console.error('„É°„É¢„Éá„Éº„Çø‰øùÂ≠ò„Ç®„É©„Éº:', error);
                updateMemoStatus('‰øùÂ≠ò„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü', false);
            }
        }
        
        // „É°„É¢„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø
        function loadMemoData() {
            try {
                const savedData = localStorage.getItem(MEMO_STORAGE_KEY);
                if (savedData) {
                    const memoData = JSON.parse(savedData);
                    const rows = document.querySelectorAll('.memo-table tbody tr');
                    
                    // „Éá„Éº„Çø„Çí„ÉÜ„Éº„Éñ„É´„Å´Âæ©ÂÖÉ
                    memoData.forEach((item, index) => {
                        if (index < rows.length) {
                            const inputs = rows[index].querySelectorAll('input');
                            inputs[0].value = item.ticker || '';
                            inputs[1].value = item.name || '';
                            inputs[2].value = item.memo || '';
                        }
                    });
                    
                    updateMemoStatus(`${memoData.length}‰ª∂„ÅÆ„É°„É¢„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü`, true);
                    console.log('„É°„É¢„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÂÆå‰∫Ü:', memoData);
                } else {
                    updateMemoStatus('‰øùÂ≠ò„Åï„Çå„Åü„É°„É¢„Éá„Éº„Çø„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì', false);
                }
            } catch (error) {
                console.error('„É°„É¢„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
                updateMemoStatus('Ë™≠„ÅøËæº„Åø„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü', false);
            }
        }
        
        // „Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫„ÇíÊõ¥Êñ∞
        function updateMemoStatus(message, isSuccess) {
            const statusElement = document.getElementById('memo-status');
            statusElement.textContent = message;
            statusElement.className = isSuccess ? 'memo-status saved' : 'memo-status';
            
            // 3ÁßíÂæå„Å´„É°„ÉÉ„Çª„Éº„Ç∏„Çí„ÇØ„É™„Ç¢
            setTimeout(() => {
                statusElement.textContent = '';
            }, 3000);
        }
        
        // ÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„Å´Â§âÊõ¥„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíËøΩÂä†
        function addMemoEventListeners() {
            const inputs = document.querySelectorAll('.memo-table input');
            inputs.forEach(input => {
                input.addEventListener('input', () => {
                    // Â∞ë„ÅóÈÅÖÂª∂„Åï„Åõ„Å¶„Åã„Çâ‰øùÂ≠òÔºàÈÄ£Á∂öÂÖ•ÂäõÊôÇ„ÅÆ„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÂØæÁ≠ñÔºâ
                    clearTimeout(input.saveTimeout);
                    input.saveTimeout = setTimeout(saveMemoData, 500);
                });
            });
        }
        
        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„ÅÆÂá¶ÁêÜ
        // „Éê„ÉÉ„ÇØ„ÉÜ„Çπ„ÉàÈñ¢ÈÄ£„ÅÆÈñ¢Êï∞
        async function runBacktest() {
            console.log('„Éê„ÉÉ„ÇØ„ÉÜ„Çπ„ÉàÈñãÂßã');
            
            const ticker = document.getElementById('ticker').value.trim();
            const startDate = document.getElementById('backtest-start-date').value;
            const endDate = document.getElementById('backtest-end-date').value;
            const strategy = document.getElementById('strategy-select').value;
            const initialCapital = parseInt(document.getElementById('initial-capital').value);
            
            console.log('Ë®≠ÂÆöÂÄ§:', { ticker, startDate, endDate, strategy, initialCapital });
            
            if (!ticker) {
                alert('ÈäòÊüÑ„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            if (!startDate || !endDate) {
                alert('ÊúüÈñì„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            const loadingElement = document.getElementById('backtest-loading');
            const resultsElement = document.getElementById('backtest-results');
            
            console.log('UIË¶ÅÁ¥†Á¢∫Ë™ç:', { 
                loading: !!loadingElement, 
                results: !!resultsElement 
            });
            
            loadingElement.style.display = 'block';
            resultsElement.style.display = 'none';
            
            try {
                console.log('API„É™„ÇØ„Ç®„Çπ„ÉàÈÄÅ‰ø°‰∏≠...');
                
                const requestBody = {
                    ticker: ticker,
                    start_date: startDate,
                    end_date: endDate,
                    strategy: strategy,
                    initial_capital: initialCapital
                };
                
                console.log('„É™„ÇØ„Ç®„Çπ„Éà„Éú„Éá„Ç£:', requestBody);
                
                const response = await fetch('/backtest', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });
                
                console.log('„É¨„Çπ„Éù„É≥„ÇπÂèó‰ø°:', response.status, response.statusText);
                
                const data = await response.json();
                console.log('„É¨„Çπ„Éù„É≥„Çπ„Éá„Éº„Çø:', data);
                
                if (data.success) {
                    console.log('„Éê„ÉÉ„ÇØ„ÉÜ„Çπ„ÉàÊàêÂäü„ÄÅÁµêÊûúË°®Á§∫ÈñãÂßã');
                    displayBacktestResults(data.data);
                } else {
                    console.error('„Éê„ÉÉ„ÇØ„ÉÜ„Çπ„ÉàÂ§±Êïó:', data.error);
                    throw new Error(data.error);
                }
            } catch (error) {
                console.error('„Éê„ÉÉ„ÇØ„ÉÜ„Çπ„Éà„Ç®„É©„Éº:', error);
                alert('„Éê„ÉÉ„ÇØ„ÉÜ„Çπ„Éà„ÅÆÂÆüË°å‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + error.message);
            } finally {
                console.log('„É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫„ÇíÈùûË°®Á§∫');
                loadingElement.style.display = 'none';
            }
        }
        
        function displayBacktestResults(data) {
            console.log('ÁµêÊûúË°®Á§∫ÈñãÂßã, „Éá„Éº„Çø:', data);
            
            const resultsElement = document.getElementById('backtest-results');
            if (!resultsElement) {
                console.error('ÁµêÊûúË°®Á§∫Ë¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            console.log('ÁµêÊûúË¶ÅÁ¥†„ÇíË°®Á§∫');
            resultsElement.style.display = 'block';
            
            try {
                // „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„Çµ„Éû„É™„Éº„ÇíË°®Á§∫
                console.log('„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„Çµ„Éû„É™„ÉºË°®Á§∫');
                displayPerformanceSummary(data.backtest_result);
                
                // „ÉÅ„É£„Éº„Éà„ÇíË°®Á§∫
                console.log('„ÉÅ„É£„Éº„ÉàË°®Á§∫');
                displayBacktestChart(data.chart_data);
                
                // ÂèñÂºïÂ±•Ê≠¥„ÇíË°®Á§∫
                console.log('ÂèñÂºïÂ±•Ê≠¥Ë°®Á§∫');
                displayTradesList(data.trades);
                
                // Ë©≥Á¥∞ÊåáÊ®ô„ÇíË°®Á§∫
                console.log('Ë©≥Á¥∞ÊåáÊ®ôË°®Á§∫');
                displayDetailedMetrics(data.detailed_metrics);
                
                // „Çπ„Éà„É©„ÉÜ„Ç∏„Éº„Éë„É©„É°„Éº„Çø„ÇíË°®Á§∫
                console.log('„Çπ„Éà„É©„ÉÜ„Ç∏„Éº„Éë„É©„É°„Éº„ÇøË°®Á§∫');
                displayStrategyParams(data.strategy_info);
                
                console.log('„Åô„Åπ„Å¶„ÅÆÁµêÊûúË°®Á§∫ÂÆå‰∫Ü');
            } catch (error) {
                console.error('ÁµêÊûúË°®Á§∫‰∏≠„Å´„Ç®„É©„Éº:', error);
            }
        }
        
        function displayPerformanceSummary(performance) {
            console.log('„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„Çµ„Éû„É™„ÉºÈñ¢Êï∞ÈñãÂßã, „Éá„Éº„Çø:', performance);
            const container = document.getElementById('performance-summary');
            
            if (!container) {
                console.error('performance-summaryË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            const cards = [
                {
                    title: 'Á∑è„É™„Çø„Éº„É≥',
                    value: (performance.performance.total_return_pct ?? 0).toFixed(2) + '%',
                    type: (performance.performance.total_return_pct ?? 0) > 0 ? 'positive' : 'negative'
                },
                {
                    title: 'ÂèñÂºïÂõûÊï∞',
                    value: performance.performance.total_trades,
                    type: 'neutral'
                },
                {
                    title: 'ÂãùÁéá',
                    value: (performance.performance.win_rate ?? 0).toFixed(1) + '%',
                    type: (performance.performance.win_rate ?? 0) > 50 ? 'positive' : 'negative'
                },
                {
                    title: '„Ç∑„É£„Éº„Éó„É¨„Ç∑„Ç™',
                    value: performance.risk_metrics.sharpe_ratio?.toFixed(2) || 'N/A',
                    type: (performance.risk_metrics.sharpe_ratio || 0) > 1 ? 'positive' : 'negative'
                },
                {
                    title: 'ÊúÄÂ§ß„Éâ„É≠„Éº„ÉÄ„Ç¶„É≥',
                    value: (performance.risk_metrics.max_drawdown ?? 0).toFixed(2) + '%',
                    type: 'negative'
                },
                {
                    title: '„Éê„Ç§&„Éõ„Éº„É´„ÉâÊØîËºÉ',
                    value: (performance.market_comparison.alpha ?? 0).toFixed(2) + '%',
                    type: (performance.market_comparison.alpha ?? 0) > 0 ? 'positive' : 'negative'
                }
            ];
            
            container.innerHTML = cards.map(card => `
                <div class="performance-card">
                    <h4>${card.title}</h4>
                    <div class="value ${card.type}">${card.value}</div>
                </div>
            `).join('');
            
            // Á∑èÂêàË©ï‰æ°„ÇíË°®Á§∫
            try {
                console.log('Á∑èÂêàË©ï‰æ°Ë®àÁÆóÈñãÂßã');
                const overallRating = calculateOverallRating(performance);
                console.log('Á∑èÂêàË©ï‰æ°ÁµêÊûú:', overallRating);
                
                const ratingContainer = document.getElementById('overall-rating');
                if (ratingContainer) {
                    ratingContainer.className = `overall-rating ${overallRating.ratingClass}`;
                    ratingContainer.innerHTML = `
                        <div>üèÜ Á∑èÂêàË©ï‰æ°: ${overallRating.rating}</div>
                        <div style="font-size: 14px; margin-top: 8px; font-weight: normal;">${overallRating.message}</div>
                        <div style="font-size: 12px; margin-top: 8px; font-weight: normal;">
                            ${overallRating.factors.length > 0 ? 'Ë©ï‰æ°Ë¶ÅÂõ†: ' + overallRating.factors.join('„ÄÅ') : ''}
                        </div>
                    `;
                    console.log('Á∑èÂêàË©ï‰æ°Ë°®Á§∫ÂÆå‰∫Ü');
                } else {
                    console.error('overall-ratingË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                }
            } catch (error) {
                console.error('Á∑èÂêàË©ï‰æ°Ë°®Á§∫„Åß„Ç®„É©„Éº:', error);
            }
        }
        
        function displayBacktestChart(chartData) {
            try {
                console.log('„ÉÅ„É£„Éº„ÉàÊèèÁîªÈñãÂßã, „Éá„Éº„Çø:', chartData);
                
                if (!chartData || !chartData.dates || !chartData.prices) {
                    console.error('„ÉÅ„É£„Éº„Éà„Éá„Éº„Çø„Åå‰∏çÊ≠£„Åß„Åô:', chartData);
                    return;
                }
                
                const trace1 = {
                    x: chartData.dates,
                    y: chartData.prices,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Ê†™‰æ°',
                    line: { color: '#3b82f6', width: 2 }
                };
                
                const buyTrace = {
                    x: chartData.signals?.buy_dates || [],
                    y: chartData.signals?.buy_prices || [],
                    type: 'scatter',
                    mode: 'markers',
                    name: 'Ë≤∑„ÅÑ„Ç∑„Ç∞„Éä„É´',
                    marker: { color: '#10b981', size: 8, symbol: 'triangle-up' }
                };
                
                const sellTrace = {
                    x: chartData.signals?.sell_dates || [],
                    y: chartData.signals?.sell_prices || [],
                    type: 'scatter',
                    mode: 'markers',
                    name: 'Â£≤„Çä„Ç∑„Ç∞„Éä„É´',
                    marker: { color: '#ef4444', size: 8, symbol: 'triangle-down' }
                };
                
                const layout = {
                    title: '„Éê„ÉÉ„ÇØ„ÉÜ„Çπ„ÉàÁµêÊûú',
                    xaxis: { title: 'Êó•‰ªò' },
                    yaxis: { title: '‰æ°Ê†º (ÂÜÜ)' },
                    plot_bgcolor: '#ffffff',
                    paper_bgcolor: '#ffffff',
                    font: { color: '#1e293b' },
                    showlegend: true
                };
                
                console.log('Plotly„Åß„ÉÅ„É£„Éº„ÉàÊèèÁîª‰∏≠');
                Plotly.newPlot('backtest-chart', [trace1, buyTrace, sellTrace], layout, {responsive: true});
                console.log('„ÉÅ„É£„Éº„ÉàÊèèÁîªÂÆå‰∫Ü');
            } catch (error) {
                console.error('„ÉÅ„É£„Éº„ÉàÊèèÁîª„Åß„Ç®„É©„Éº:', error);
            }
        }
        
        function displayTradesList(trades) {
            const container = document.getElementById('trades-table');
            
            if (!trades || trades.length === 0) {
                container.innerHTML = '<p>ÂèñÂºïÂ±•Ê≠¥„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
                return;
            }
            
            const tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>„Ç®„É≥„Éà„É™„ÉºÊó•</th>
                            <th>„Ç®„Ç∞„Ç∏„ÉÉ„ÉàÊó•</th>
                            <th>„Ç®„É≥„Éà„É™„Éº‰æ°Ê†º</th>
                            <th>„Ç®„Ç∞„Ç∏„ÉÉ„Éà‰æ°Ê†º</th>
                            <th>ÊêçÁõä</th>
                            <th>ÊêçÁõäÁéá</th>
                            <th>‰øùÊúâÊó•Êï∞</th>
                            <th>ÁêÜÁî±</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${trades.map(trade => `
                            <tr>
                                <td>${trade.entry_date}</td>
                                <td>${trade.exit_date}</td>
                                <td>¬•${trade.entry_price.toLocaleString()}</td>
                                <td>¬•${trade.exit_price.toLocaleString()}</td>
                                <td class="${trade.profit_loss > 0 ? 'profit' : 'loss'}">
                                    ¬•${trade.profit_loss.toLocaleString()}
                                </td>
                                <td class="${trade.profit_loss_pct > 0 ? 'profit' : 'loss'}">
                                    ${trade.profit_loss_pct.toFixed(2)}%
                                </td>
                                <td>${trade.holding_days}Êó•</td>
                                <td>${trade.entry_reason} ‚Üí ${trade.exit_reason}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = tableHTML;
        }
        
        function displayDetailedMetrics(metrics) {
            const container = document.getElementById('detailed-metrics');
            
            const groups = [
                {
                    title: 'Âü∫Êú¨Áµ±Ë®à',
                    data: metrics.basic_stats,
                    format: {
                        total_return: (v) => `¬•${v.toLocaleString()}`,
                        total_return_pct: (v) => `${v.toFixed(2)}%`,
                        win_rate: (v) => `${v.toFixed(1)}%`,
                        avg_return_per_trade: (v) => `¬•${v.toLocaleString()}`,
                        avg_holding_days: (v) => `${v.toFixed(1)}Êó•`
                    }
                },
                {
                    title: '„É™„Çπ„ÇØÊåáÊ®ô',
                    data: metrics.risk_metrics,
                    format: {
                        max_drawdown: (v) => `${v.toFixed(2)}%`,
                        volatility: (v) => `${v.toFixed(2)}%`,
                        sharpe_ratio: (v) => v.toFixed(2),
                        sortino_ratio: (v) => v.toFixed(2),
                        var_95: (v) => `${v.toFixed(2)}%`
                    }
                },
                {
                    title: 'ÂèéÁõäÊÄßÊåáÊ®ô',
                    data: metrics.profitability_metrics,
                    format: {
                        gross_profit: (v) => `¬•${v.toLocaleString()}`,
                        gross_loss: (v) => `¬•${v.toLocaleString()}`,
                        profit_factor: (v) => v.toFixed(2),
                        payoff_ratio: (v) => v.toFixed(2),
                        expectancy: (v) => `¬•${v.toLocaleString()}`
                    }
                }
            ];
            
            container.innerHTML = groups.map(group => `
                <div class="metric-group">
                    <h4>${group.title}</h4>
                    ${Object.entries(group.data || {}).map(([key, value]) => {
                        const formatter = group.format[key] || ((v) => v);
                        const displayKey = key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                        return `
                            <div class="metric-item">
                                <span class="metric-label">${displayKey}</span>
                                <span class="metric-value">${formatter(value)}</span>
                            </div>
                        `;
                    }).join('')}
                </div>
            `).join('');
        }
        
        function displayStrategyParams(strategyInfo) {
            const container = document.getElementById('strategy-parameters');
            
            container.innerHTML = `
                <div class="metric-group">
                    <h4>${strategyInfo.name}</h4>
                    <p style="margin-bottom: 15px; color: #64748b;">${strategyInfo.description}</p>
                    ${Object.entries(strategyInfo.params).map(([key, value]) => {
                        const displayKey = key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                        return `
                            <div class="metric-item">
                                <span class="metric-label">${displayKey}</span>
                                <span class="metric-value">${value}</span>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }
        
        function showSubTab(tabId) {
            // „Åô„Åπ„Å¶„ÅÆ„Çµ„Éñ„Çø„Éñ„Å®„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÈùûË°®Á§∫
            document.querySelectorAll('.tab-sub').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.sub-tab-content').forEach(content => content.classList.remove('active'));
            
            // ÈÅ∏Êäû„Åï„Çå„Åü„Çø„Éñ„Å®„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíË°®Á§∫
            event.target.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }
        
        // Portfolio Management Functions
        function showPortfolioTab(tabId) {
            // „Åô„Åπ„Å¶„ÅÆ„Éù„Éº„Éà„Éï„Ç©„É™„Ç™„Çø„Éñ„Å®„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÈùûË°®Á§∫
            document.querySelectorAll('.portfolio-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.portfolio-tab-content').forEach(content => content.classList.remove('active'));
            
            // ÈÅ∏Êäû„Åï„Çå„Åü„Çø„Éñ„Å®„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíË°®Á§∫
            event.target.classList.add('active');
            document.getElementById(tabId).classList.add('active');
            
            // „Çø„Éñ„ÅåË°®Á§∫„Åï„Çå„Åü„Å®„Åç„Å´„Éá„Éº„Çø„Çí„É≠„Éº„Éâ
            if (tabId === 'portfolio-holdings') {
                loadPortfolioData();
            } else if (tabId === 'watchlist') {
                loadWatchlistData();
            } else if (tabId === 'notes') {
                loadNotesData();
            } else if (tabId === 'history') {
                loadHistoryData();
            }
        }
        
        async function loadPortfolioData() {
            try {
                const response = await fetch('/api/portfolio/portfolio');
                const result = await response.json();
                
                if (result.success) {
                    displayPortfolioData(result.data.portfolio);
                    updatePortfolioSummary(result.data.summary);
                } else {
                    console.error('Portfolio data load error:', result.error);
                }
            } catch (error) {
                console.error('Failed to load portfolio data:', error);
            }
        }
        
        function displayPortfolioData(portfolio) {
            const tbody = document.getElementById('portfolio-tbody');
            
            if (!portfolio || portfolio.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; color: #64748b; padding: 20px;">
                            „Éù„Éº„Éà„Éï„Ç©„É™„Ç™„Å´ÈäòÊüÑ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = portfolio.map(item => {
                const profitLoss = item.profit_loss || 0;
                const profitLossPct = item.profit_loss_pct || 0;
                const profitClass = profitLoss >= 0 ? 'profit' : 'loss';
                
                return `
                    <tr>
                        <td>${item.ticker}</td>
                        <td>${item.company_name || ''}</td>
                        <td>${(item.shares || 0).toLocaleString()}</td>
                        <td>Ôø•${(item.average_price || 0).toLocaleString()}</td>
                        <td>Ôø•${(item.current_price || 0).toLocaleString()}</td>
                        <td class="${profitClass}">Ôø•${profitLoss.toLocaleString()}</td>
                        <td class="${profitClass}">${profitLossPct.toFixed(2)}%</td>
                        <td>
                            <button class="btn btn-danger" style="font-size: 10px; padding: 4px 8px;" 
                                    onclick="removeFromPortfolio(${item.id})">ÂâäÈô§</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function updatePortfolioSummary(summary) {
            document.getElementById('total-stocks').textContent = summary.total_stocks || 0;
            document.getElementById('total-investment').textContent = `Ôø•${(summary.total_investment || 0).toLocaleString()}`;
            document.getElementById('current-value').textContent = `Ôø•${(summary.current_value || 0).toLocaleString()}`;
            
            const profitLoss = summary.total_profit_loss || 0;
            const profitLossPct = summary.total_profit_loss_pct || 0;
            const profitClass = profitLoss >= 0 ? 'positive' : 'negative';
            
            const profitLossElement = document.getElementById('total-profit-loss');
            const profitLossPctElement = document.getElementById('total-profit-loss-pct');
            
            profitLossElement.textContent = `Ôø•${profitLoss.toLocaleString()}`;
            profitLossElement.className = `value ${profitClass}`;
            
            profitLossPctElement.textContent = `${profitLossPct.toFixed(2)}%`;
            profitLossPctElement.className = `value ${profitClass}`;
        }
        
        async function loadWatchlistData() {
            try {
                const response = await fetch('/api/portfolio/watchlist');
                const result = await response.json();
                
                if (result.success) {
                    displayWatchlistData(result.data);
                } else {
                    console.error('Watchlist data load error:', result.error);
                }
            } catch (error) {
                console.error('Failed to load watchlist data:', error);
            }
        }
        
        function displayWatchlistData(watchlist) {
            const tbody = document.getElementById('watchlist-tbody');
            
            if (!watchlist || watchlist.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; color: #64748b; padding: 20px;">
                            „Ç¶„Ç©„ÉÉ„ÉÅ„É™„Çπ„Éà„Å´ÈäòÊüÑ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = watchlist.map(item => {
                const targetPrice = item.target_price ? `Ôø•${item.target_price.toLocaleString()}` : '-';
                const alertEnabled = item.alert_enabled ? '‚úÖ' : '‚ùå';
                const dateAdded = new Date(item.date_added).toLocaleDateString('ja-JP');
                
                return `
                    <tr>
                        <td>${item.ticker}</td>
                        <td>${item.company_name || ''}</td>
                        <td>${targetPrice}</td>
                        <td>${alertEnabled}</td>
                        <td>${dateAdded}</td>
                        <td>
                            <button class="btn btn-danger" style="font-size: 10px; padding: 4px 8px;" 
                                    onclick="removeFromWatchlist(${item.id})">ÂâäÈô§</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        async function loadNotesData() {
            try {
                const response = await fetch('/api/portfolio/notes');
                const result = await response.json();
                
                if (result.success) {
                    displayNotesData(result.data);
                } else {
                    console.error('Notes data load error:', result.error);
                }
            } catch (error) {
                console.error('Failed to load notes data:', error);
            }
        }
        
        function displayNotesData(notes) {
            const container = document.getElementById('notes-container');
            
            if (!notes || notes.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; color: #64748b; padding: 20px;">
                        „É°„É¢„Åå„ÅÇ„Çä„Åæ„Åõ„Çì
                    </div>
                `;
                return;
            }
            
            container.innerHTML = notes.map(note => {
                const dateCreated = new Date(note.date_created).toLocaleDateString('ja-JP');
                const noteTypeColors = {
                    'general': '#6b7280',
                    'analysis': '#3b82f6',
                    'strategy': '#10b981',
                    'risk': '#ef4444',
                    'news': '#f59e0b'
                };
                const typeColor = noteTypeColors[note.note_type] || '#6b7280';
                
                return `
                    <div class="note-item">
                        <div class="note-header">
                            <div>
                                <div class="note-title">${note.title}</div>
                                <div class="note-meta">
                                    ${note.ticker} | 
                                    <span style="color: ${typeColor}; font-weight: bold;">${note.note_type}</span> | 
                                    ${dateCreated}
                                </div>
                            </div>
                            <button class="btn btn-danger" style="font-size: 10px; padding: 4px 8px;" 
                                    onclick="archiveNote(${note.id})">ÂâäÈô§</button>
                        </div>
                        <div class="note-content">${note.content}</div>
                    </div>
                `;
            }).join('');
        }
        
        async function loadHistoryData() {
            try {
                const [analysisResponse, backtestResponse] = await Promise.all([
                    fetch('/api/portfolio/analysis-history?limit=20'),
                    fetch('/api/portfolio/backtest-history?limit=20')
                ]);
                
                const analysisResult = await analysisResponse.json();
                const backtestResult = await backtestResponse.json();
                
                const allHistory = [];
                
                if (analysisResult.success) {
                    allHistory.push(...analysisResult.data.map(item => ({...item, type: 'analysis'})));
                }
                
                if (backtestResult.success) {
                    allHistory.push(...backtestResult.data.map(item => ({...item, type: 'backtest'})));
                }
                
                // Êó•‰ªò„Åß„ÇΩ„Éº„Éà
                allHistory.sort((a, b) => new Date(b.date_created) - new Date(a.date_created));
                
                displayHistoryData(allHistory);
                
            } catch (error) {
                console.error('Failed to load history data:', error);
            }
        }
        
        function displayHistoryData(history) {
            const container = document.getElementById('history-container');
            
            if (!history || history.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; color: #64748b; padding: 20px;">
                        Â±•Ê≠¥„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì
                    </div>
                `;
                return;
            }
            
            container.innerHTML = history.map(item => {
                const dateCreated = new Date(item.date_created).toLocaleDateString('ja-JP');
                let typeLabel = '';
                let summary = '';
                
                if (item.type === 'analysis') {
                    typeLabel = item.analysis_type === 'technical' ? 'Technical' : 'Fundamental';
                    summary = `${item.ticker} - ${item.analysis_type} analysis`;
                } else if (item.type === 'backtest') {
                    typeLabel = 'Backtest';
                    const returnPct = item.total_return_pct || 0;
                    summary = `${item.ticker} - ${item.strategy_name} (${returnPct.toFixed(2)}%)`;
                }
                
                return `
                    <div class="history-item">
                        <div class="history-header">
                            <div>
                                <span class="history-type ${item.analysis_type || 'backtest'}">${typeLabel}</span>
                                <strong>${summary}</strong>
                            </div>
                            <div class="note-meta">${dateCreated}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Form handling functions
        document.addEventListener('DOMContentLoaded', function() {
            // Portfolio form
            document.getElementById('add-to-portfolio-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const ticker = document.getElementById('add-ticker').value;
                const shares = parseInt(document.getElementById('add-shares').value);
                const price = parseFloat(document.getElementById('add-price').value);
                const notes = document.getElementById('add-notes').value;
                
                try {
                    const response = await fetch('/api/portfolio/portfolio', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            ticker: ticker,
                            shares: shares,
                            average_price: price,
                            notes: notes
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        alert('„Éù„Éº„Éà„Éï„Ç©„É™„Ç™„Å´ËøΩÂä†„Åó„Åæ„Åó„Åü');
                        clearAddForm();
                        loadPortfolioData();
                    } else {
                        alert('„Ç®„É©„Éº: ' + result.error);
                    }
                } catch (error) {
                    alert('ÈÄö‰ø°„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü');
                    console.error(error);
                }
            });
            
            // Watchlist form
            document.getElementById('add-to-watchlist-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const ticker = document.getElementById('watch-ticker').value;
                const targetPrice = parseFloat(document.getElementById('watch-target-price').value) || null;
                const notes = document.getElementById('watch-notes').value;
                
                try {
                    const response = await fetch('/api/portfolio/watchlist', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            ticker: ticker,
                            target_price: targetPrice,
                            notes: notes
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        alert('„Ç¶„Ç©„ÉÉ„ÉÅ„É™„Çπ„Éà„Å´ËøΩÂä†„Åó„Åæ„Åó„Åü');
                        clearWatchForm();
                        loadWatchlistData();
                    } else {
                        alert('„Ç®„É©„Éº: ' + result.error);
                    }
                } catch (error) {
                    alert('ÈÄö‰ø°„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü');
                    console.error(error);
                }
            });
            
            // Notes form
            document.getElementById('add-note-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const ticker = document.getElementById('note-ticker').value;
                const title = document.getElementById('note-title').value;
                const noteType = document.getElementById('note-type').value;
                const content = document.getElementById('note-content').value;
                
                try {
                    const response = await fetch('/api/portfolio/notes', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            ticker: ticker,
                            title: title,
                            note_type: noteType,
                            content: content
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        alert('„É°„É¢„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
                        clearNoteForm();
                        loadNotesData();
                    } else {
                        alert('„Ç®„É©„Éº: ' + result.error);
                    }
                } catch (error) {
                    alert('ÈÄö‰ø°„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü');
                    console.error(error);
                }
            });
            
            // Load portfolio data on page load if portfolio tab is active
            if (document.getElementById('portfolio-tab').classList.contains('active')) {
                loadPortfolioData();
            }
        });
        
        function clearAddForm() {
            document.getElementById('add-ticker').value = '';
            document.getElementById('add-shares').value = '';
            document.getElementById('add-price').value = '';
            document.getElementById('add-notes').value = '';
        }
        
        function clearWatchForm() {
            document.getElementById('watch-ticker').value = '';
            document.getElementById('watch-target-price').value = '';
            document.getElementById('watch-notes').value = '';
        }
        
        function clearNoteForm() {
            document.getElementById('note-ticker').value = '';
            document.getElementById('note-title').value = '';
            document.getElementById('note-type').value = 'general';
            document.getElementById('note-content').value = '';
        }
        
        async function removeFromPortfolio(portfolioId) {
            if (!confirm('„Åì„ÅÆÈäòÊüÑ„Çí„Éù„Éº„Éà„Éï„Ç©„É™„Ç™„Åã„ÇâÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/portfolio/portfolio/${portfolioId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('ÂâäÈô§„Åó„Åæ„Åó„Åü');
                    loadPortfolioData();
                } else {
                    alert('„Ç®„É©„Éº: ' + result.error);
                }
            } catch (error) {
                alert('ÈÄö‰ø°„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü');
                console.error(error);
            }
        }
        
        async function removeFromWatchlist(watchlistId) {
            if (!confirm('„Åì„ÅÆÈäòÊüÑ„Çí„Ç¶„Ç©„ÉÉ„ÉÅ„É™„Çπ„Éà„Åã„ÇâÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/portfolio/watchlist/${watchlistId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('ÂâäÈô§„Åó„Åæ„Åó„Åü');
                    loadWatchlistData();
                } else {
                    alert('„Ç®„É©„Éº: ' + result.error);
                }
            } catch (error) {
                alert('ÈÄö‰ø°„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü');
                console.error(error);
            }
        }
        
        async function archiveNote(noteId) {
            if (!confirm('„Åì„ÅÆ„É°„É¢„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/portfolio/notes/${noteId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('ÂâäÈô§„Åó„Åæ„Åó„Åü');
                    loadNotesData();
                } else {
                    alert('„Ç®„É©„Éº: ' + result.error);
                }
            } catch (error) {
                alert('ÈÄö‰ø°„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü');
                console.error(error);
            }
        }
        
        // Êñ∞„Åó„ÅÑ„Éê„ÉÉ„ÇØ„ÉÜ„Çπ„ÉàUIÁî®Èñ¢Êï∞
        function setPresetPeriod(days) {
            const endDate = new Date();
            const startDate = new Date();
            startDate.setDate(endDate.getDate() - days);
            
            document.getElementById('backtest-end-date').value = endDate.toISOString().split('T')[0];
            document.getElementById('backtest-start-date').value = startDate.toISOString().split('T')[0];
        }
        
        function setCapital(amount) {
            document.getElementById('initial-capital').value = amount;
        }
        
        function showStrategyDescription() {
            const strategySelect = document.getElementById('strategy-select');
            const descriptionDiv = document.getElementById('strategy-description');
            
            const descriptions = {
                'combo': '<strong>Ë§áÂêàÊà¶Áï•:</strong> RSI„ÄÅÁßªÂãïÂπ≥ÂùáÁ∑ö„ÄÅMACD„ÄÅ„Éú„É™„É≥„Ç∏„É£„Éº„Éê„É≥„Éâ„ÇíÁµÑ„ÅøÂêà„Çè„Åõ„ÅüÁ∑èÂêàÁöÑ„Å™Âà§ÂÆö„ÇíË°å„ÅÑ„Åæ„Åô„ÄÇË§áÊï∞„ÅÆÊåáÊ®ô„Çí‰Ωø„ÅÜ„Åì„Å®„Åß„Çà„ÇäÁ≤æÂ∫¶„ÅÆÈ´ò„ÅÑÂ£≤Ë≤∑„Çø„Ç§„Éü„É≥„Ç∞„ÇíÁãô„ÅÑ„Åæ„Åô„ÄÇÔºàÂàùÂøÉËÄÖ„Å´„Åä„Åô„Åô„ÇÅÔºâ',
                'rsi': '<strong>RSIÊà¶Áï•:</strong> RSI„Åå30‰ª•‰∏ã„ÅßË≤∑„ÅÑ„ÄÅ70‰ª•‰∏ä„ÅßÂ£≤„Çä„ÅÆÈÄÜÂºµ„ÇäÊà¶Áï•„ÄÇÁü≠ÊúüÁöÑ„Å™Ë≤∑„Çè„Çå„Åô„Åé„ÉªÂ£≤„Çâ„Çå„Åô„Åé„ÇíÁãô„ÅÑ„Åæ„Åô„ÄÇ„Ç∑„É≥„Éó„É´„Åß„Åô„ÅåÁõ∏Â†¥„Å´„Çà„Å£„Å¶„ÅØÊúâÂäπ„Åß„Åô„ÄÇ',
                'golden_cross': '<strong>„Ç¥„Éº„É´„Éá„É≥„ÇØ„É≠„ÇπÊà¶Áï•:</strong> 25Êó•ÁßªÂãïÂπ≥ÂùáÁ∑ö„Åå75Êó•ÁßªÂãïÂπ≥ÂùáÁ∑ö„Çí‰∏äÊäú„Åë„Åü„ÇâË≤∑„ÅÑ„ÄÅ‰∏ãÊäú„Åë„Åü„ÇâÂ£≤„Çä„ÅÆÈ†ÜÂºµ„ÇäÊà¶Áï•„ÄÇ„Éà„É¨„É≥„Éâ„ÅÆËª¢ÊèõÁÇπ„ÇíÊçâ„Åà„Åæ„Åô„ÄÇ',
                'macd': '<strong>MACDÊà¶Áï•:</strong> MACD„Å®„Ç∑„Ç∞„Éä„É´Á∑ö„ÅÆ„ÇØ„É≠„Çπ„ÅßÂ£≤Ë≤∑Âà§Êñ≠„ÇíË°å„ÅÑ„Åæ„Åô„ÄÇ„Éà„É¨„É≥„Éâ„ÅÆÂã¢„ÅÑ„Å®Ëª¢ÊèõÁÇπ„ÇíÂêåÊôÇ„Å´Âà§Êñ≠„Åß„Åç„ÇãÂÑ™„Çå„ÅüÊåáÊ®ô„Åß„Åô„ÄÇ',
                'bollinger': '<strong>„Éú„É™„É≥„Ç∏„É£„Éº„Éê„É≥„ÉâÊà¶Áï•:</strong> ‰æ°Ê†º„Åå„Éê„É≥„Éâ„ÅÆ‰∏äÈôê„Å´ÈÅî„Åó„Åü„ÇâÂ£≤„Çä„ÄÅ‰∏ãÈôê„Å´ÈÅî„Åó„Åü„ÇâË≤∑„ÅÑ„ÅÆÈÄÜÂºµ„ÇäÊà¶Áï•„ÄÇÁµ±Ë®àÁöÑ„Å™‰æ°Ê†º„ÅÆÁï∞Â∏∏ÂÄ§„ÇíÁãô„ÅÑ„Åæ„Åô„ÄÇ'
            };
            
            descriptionDiv.innerHTML = descriptions[strategySelect.value] || '';
        }
        
        function toggleResultsGuide() {
            const guide = document.getElementById('results-guide');
            const icon = document.getElementById('guide-toggle-icon');
            
            if (guide.style.display === 'none') {
                guide.style.display = 'block';
                icon.textContent = '‚ñ≤';
            } else {
                guide.style.display = 'none';
                icon.textContent = '‚ñº';
            }
        }
        
        function calculateOverallRating(performance) {
            const basic = performance.performance || {};
            const risk = performance.risk_metrics || {};
            const market = performance.market_comparison || {};
            
            let score = 0;
            let factors = [];
            
            // Á∑è„É™„Çø„Éº„É≥„ÅÆË©ï‰æ°
            const totalReturn = basic.total_return_pct || 0;
            if (totalReturn > 20) {
                score += 3;
                factors.push('È´ò„É™„Çø„Éº„É≥');
            } else if (totalReturn > 10) {
                score += 2;
                factors.push('ËâØÂ•Ω„Å™„É™„Çø„Éº„É≥');
            } else if (totalReturn > 0) {
                score += 1;
                factors.push('„Éó„É©„Çπ„É™„Çø„Éº„É≥');
            } else {
                factors.push('„Éû„Ç§„Éä„Çπ„É™„Çø„Éº„É≥');
            }
            
            // ÂãùÁéá„ÅÆË©ï‰æ°
            const winRate = basic.win_rate || 0;
            if (winRate >= 70) {
                score += 3;
                factors.push('È´òÂãùÁéá');
            } else if (winRate >= 50) {
                score += 2;
                factors.push('ËâØÂ•Ω„Å™ÂãùÁéá');
            } else if (winRate >= 30) {
                score += 1;
            }
            
            // ÊúÄÂ§ß„Éâ„É≠„Éº„ÉÄ„Ç¶„É≥„ÅÆË©ï‰æ°
            const maxDrawdown = risk.max_drawdown || 0;
            if (maxDrawdown <= 5) {
                score += 3;
                factors.push('‰Ωé„É™„Çπ„ÇØ');
            } else if (maxDrawdown <= 10) {
                score += 2;
                factors.push('ÈÅ©Â∫¶„Å™„É™„Çπ„ÇØ');
            } else if (maxDrawdown <= 20) {
                score += 1;
            } else {
                factors.push('È´ò„É™„Çπ„ÇØ');
            }
            
            // „Ç∑„É£„Éº„Éó„É¨„Ç∑„Ç™„ÅÆË©ï‰æ°
            const sharpeRatio = risk.sharpe_ratio || 0;
            if (sharpeRatio >= 2) {
                score += 3;
                factors.push('ÂÑ™ÁßÄ„Å™„É™„Çπ„ÇØÂäπÁéá');
            } else if (sharpeRatio >= 1) {
                score += 2;
                factors.push('ËâØÂ•Ω„Å™„É™„Çπ„ÇØÂäπÁéá');
            } else if (sharpeRatio >= 0.5) {
                score += 1;
            }
            
            // „Éê„Ç§&„Éõ„Éº„É´„ÉâÊØîËºÉ
            const alpha = market.alpha || 0;
            if (alpha > 5) {
                score += 2;
                factors.push('Â∏ÇÂ†¥„ÇíÂ§ßÂπÖ„Å´‰∏äÂõû„Çã');
            } else if (alpha > 0) {
                score += 1;
                factors.push('Â∏ÇÂ†¥„Çí‰∏äÂõû„Çã');
            }
            
            // Ë©ï‰æ°Âà§ÂÆö
            let rating, ratingClass, message;
            if (score >= 10) {
                rating = 'ÂÑ™ÁßÄ';
                ratingClass = 'excellent';
                message = '„Åì„ÅÆÊà¶Áï•„ÅØÈùûÂ∏∏„Å´ÂÑ™ÁßÄ„Å™ÁµêÊûú„ÇíÁ§∫„Åó„Å¶„ÅÑ„Åæ„ÅôÔºÅ';
            } else if (score >= 6) {
                rating = 'ËâØÂ•Ω';
                ratingClass = 'good';
                message = '„Åì„ÅÆÊà¶Áï•„ÅØËâØÂ•Ω„Å™ÁµêÊûú„ÇíÁ§∫„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ';
            } else {
                rating = 'Ë¶ÅÊîπÂñÑ';
                ratingClass = 'poor';
                message = '„Åì„ÅÆÊà¶Áï•„ÅØÊîπÂñÑ„ÅÆ‰ΩôÂú∞„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ';
            }
            
            return {
                rating: rating,
                ratingClass: ratingClass,
                message: message,
                factors: factors,
                score: score
            };
        }
        
        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„ÅÆÂàùÊúüÂåñ
        window.addEventListener('load', function() {
            console.log('„Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÂÆå‰∫Ü');
            loadMemoData();
            addMemoEventListeners();
            
            // „Éá„Éï„Ç©„É´„Éà„ÅÆÊó•‰ªò„ÇíË®≠ÂÆöÔºà6„É∂ÊúàÂâç„Åã„ÇâÁèæÂú®„Åæ„ÅßÔºâ
            const endDate = new Date();
            const startDate = new Date();
            startDate.setMonth(endDate.getMonth() - 6);
            
            document.getElementById('backtest-end-date').value = endDate.toISOString().split('T')[0];
            document.getElementById('backtest-start-date').value = startDate.toISOString().split('T')[0];
            
            // Êà¶Áï•Ë™¨Êòé„ÅÆÂàùÊúüË°®Á§∫
            showStrategyDescription();
        });
    </script>
    
    </div> <!-- /main-content -->
</body>
</html>